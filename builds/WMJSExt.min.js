var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var p=a[f];if(b.call(c,p,f,a))return{i:f,v:p}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,e){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,e):$jscomp.polyfillUnisolated(a,b,c,e))};
$jscomp.polyfillUnisolated=function(a,b,c,e){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];if(!(f in c))return;c=c[f]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,e){var f=a.split(".");a=1===f.length;e=f[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var p=0;p<f.length-1;p++){var m=f[p];if(!(m in e))return;e=e[m]}f=f[f.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?e[f]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):
$jscomp.POLYFILL_PREFIX+f),f=$jscomp.propertyToPolyfillSymbol[f],$jscomp.defineProperty(e,f,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,e){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==e||e>f)e=f;e=Number(e);0>e&&(e=Math.max(0,f+e));for(c=Number(c||0);c<e;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,p){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:p})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,e=function(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(f||"")+"_"+c++,f)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var e=$jscomp.global[b[c]];"function"===typeof e&&"function"!=typeof e.prototype[a]&&$jscomp.defineProperty(e.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,e=!1,f={next:function(){if(!e&&c<a.length){var p=c++;return{value:b(p,a[p]),done:!1}}e=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var e=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=e.length);c=Math.max(0,Math.min(c|0,e.length));for(var f=b.length;0<f&&0<c;)if(e[--c]!=b[--f])return!1;return 0>=f}},"es6","es3");var WMJSExtApplications=[];Ext.define("webmapjsext.WMJSExt.LayerPropertiesPanel",{extend:"Ext.tab.Panel",alias:"WMJSExtLayerPropertiesPanel",initComponent:function(){var a=this;a.applyColorScaleRange=function(){var c=a.getComponent("wmsextensions").getComponent("colorscalerangeminvalue").getValue(),e=a.getComponent("wmsextensions").getComponent("colorscalerangemaxvalue").getValue();a.WMJSLayerObject.wmsextensions({colorscalerange:c+","+e});a.WMJSLayerObject.draw("LayerPropertiesPanel::applyColorScaleRange")};a.applyWMSVersion=
function(){var c=a.getComponent("wmsversionpanel").getComponent("wmsversion").getValue();a.WMJSLayerObject.version=c;a.WMJSLayerObject.draw("LayerPropertiesPanel::applyWMSVersion")};a.projectionStore=Ext.create("Ext.data.Store",{fields:["title","srs","bbox"],data:{items:[]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});var b=function(){Ext.create("Ext.window.Window",{width:"90%",height:"90%",autoDestroy:!0,closeAction:"close",maximizable:!0,layout:"fit",items:[Ext.create("WCSPanel",{autoDestroy:!0,
closeAction:"close",WMJSLayer:a.WMJSLayerObject})]}).show()};Ext.apply(this,{layout:"fit",frame:!1,border:!1,margin:0,items:[{xtype:"panel",title:I18n.color_range.text,margin:6,itemId:"wmsextensions",items:[{itemId:"colorscalerangeminvalue",xtype:"numberfield",fieldLabel:I18n.min_value.text,value:0,margin:6,listeners:{specialkey:function(c,e){e.getKey()==e.ENTER&&a.applyColorScaleRange()}}},{itemId:"colorscalerangemaxvalue",xtype:"numberfield",fieldLabel:I18n.max_value.text,value:"1.0",margin:6,listeners:{specialkey:function(c,
e){e.getKey()==e.ENTER&&a.applyColorScaleRange()}}}],buttons:[{xtype:"button",text:I18n.reset.text,handler:function(){a.WMJSLayerObject.wmsextensions({colorscalerange:""});a.WMJSLayerObject.draw("LayerPropertiesPanel::reset")}},{xtype:"button",text:I18n.apply.text,handler:function(){a.applyColorScaleRange()}}]},{xtype:"panel",title:I18n.wms_version.text,margin:6,itemId:"wmsversionpanel",items:[{itemId:"wmsversion",xtype:"textfield",labelWidth:250,margin:6,fieldLabel:I18n.wms_version.text,value:a.WMJSLayerObject.version,
listeners:{specialkey:function(c,e){e.getKey()==e.ENTER&&a.applyWMSVersion()}}},{xtype:"checkbox",itemId:"usewms130comaptmode",labelWidth:250,fieldLabel:I18n.wms_comp_mode.text,margin:6,listeners:{change:function(c,e){a.WMJSLayerObject.wms130bboxcompatibilitymode=e;a.WMJSLayerObject.draw("LayerPropertiesPanel::WMS1.3.0CompatMode")}}}]},{xtype:"panel",title:I18n.projections.text,margin:6,itemId:"wmsprojectionpanel",layout:"fit",items:[{xtype:"grid",border:!1,store:a.projectionStore,columns:[{text:I18n.title.text,
dataIndex:"title",flex:2},{text:I18n.epsg_code.text,dataIndex:"srs",flex:1},{text:I18n.bounding_box.text,dataIndex:"bbox",flex:2}],listeners:{select:{fn:function(c,e){c=e.get("bbox");e=e.get("srs");a.WMJSLayerObject.parentMaps[0].setProjection({srs:e,bbox:c});a.WMJSLayerObject.parentMaps[0].draw("wmsprojectionpanel")}}}}],listeners:{show:{fn:function(){a.projectionStore.removeAll();for(var c=0;c<a.WMJSLayerObject.projectionProperties.length;c++){var e=a.WMJSLayerObject.projectionProperties[c].srs;
try{e=epsgDescriptionLookup[a.WMJSLayerObject.projectionProperties[c].srs]}catch(f){}isDefined(e)||(e=a.WMJSLayerObject.projectionProperties[c].srs);a.projectionStore.add({title:e,srs:a.WMJSLayerObject.projectionProperties[c].srs,bbox:a.WMJSLayerObject.projectionProperties[c].bbox})}}}}},{xtype:"panel",title:I18n.file_metadata.text,margin:6,itemId:"wmsfilemetadatapanel",layout:"fit",listeners:{show:{fn:function(){a.getComponent("wmsfilemetadatapanel").update('<a target="_blank" href="'+a.WMJSLayerObject.service+
"&service=wms&request=getmetadata&format=image/png&srs=EPSG:4326&layer="+a.WMJSLayerObject.name+'">'+I18n.show_file_metadata.text+"</a>")}}}},{xtype:"panel",title:I18n.download_data_wcs.text,margin:6,itemId:"wcs",layout:"fit",items:[{xtype:"button",text:I18n.show.text,handler:function(){b()}}],listeners:{show:{fn:function(){b()}}}}],listeners:{afterlayout:{fn:function(){}}}});webmapjsext.WMJSExt.LayerPropertiesPanel.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.StylePanel",{extend:"Ext.panel.Panel",alias:"WMJSExtStylePanel",initComponent:function(){var a=this;a.buildData=function(){var b=[];if(!this.WMJSLayerObject.styles)return{name:I18n.default.text,title:I18n.default.text,abstracttext:I18n.no_styles_available.text};for(var c=0;c<a.WMJSLayerObject.styles.length;c++){var e={title:a.WMJSLayerObject.styles[c].title,name:a.WMJSLayerObject.styles[c].name,abstracttext:a.WMJSLayerObject.styles[c].abstracttext,legend:a.WMJSLayerObject.styles[c].legendURL};
b.push(e);0==c&&(a.defaultStyle=e)}return b};a.store=Ext.create("Ext.data.Store",{fields:[{name:"title",type:"string"},{name:"name",type:"string"},{name:"legend",type:"string"},{name:"abstracttext",type:"string"}]});a.grid=Ext.create("Ext.grid.Panel",{store:a.store,columns:[{header:I18n.title.text,dataIndex:"title",width:180},{header:I18n.name.text,dataIndex:"name",width:100},{header:I18n.description.text,dataIndex:"abstracttext",flex:!0}],border:0,listeners:{itemclick:{fn:function(b,c,e,f,p,m){a.itemclick&&
a.itemclick(a,{name:c.get("name"),title:c.get("title")})}},itemmouseenter:{fn:function(b,c,e,f,p,m){b=c.get("legend");a.legendWindow||(a.legendWindow=Ext.create("Ext.window.Window",{header:!1,layout:"auto",width:200,minHeight:300,autoDestroy:!1,closeAction:"hide",autoScroll:!1}));c=a.getPosition()[0]+a.getWidth()+10;e=a.getPosition()[1];a.legendWindow.showAt([c,e]);a.legendWindow.update('<img class="legendimage" src="'+b+'&transparent=true"/>')}},itemmouseleave:{fn:function(){a.legendWindow.hide()}}}});
a.loadStyles=function(b){a.WMJSLayerObject=b;a.store.loadRawData(a.buildData())};Ext.apply(this,{closable:!0,border:!1,layout:"fit",maxHeight:300,autoScroll:!0,items:[this.grid]});this.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.DimensionPanel",{extend:"Ext.panel.Panel",alias:"WMJSExtDimensionPanel",initComponent:function(a){var b=this;b.currentValue=void 0;b.currentSize=void 0;var c=0;try{c=this.dimension.getIndexForValue(this.dimension.defaultValue)}catch(f){}if(b.dimension.currentValue)try{c=this.dimension.getIndexForValue(b.dimension.currentValue)}catch(f){}-1==c&&(c=b.dimension.size()-1);b.currentIndex=c;try{b.dimension.currentValue=b.dimension.getValueForIndex(c)}catch(f){error("WMJSExtDimensionPanel: getValueForIndex "+
c+" failed")}b.dimSlider=Ext.create("Ext.slider.Single",{width:50,useTips:!1,region:"center",value:c,minValue:0,maxValue:b.dimension.size()-1,increment:1,listeners:{drag:{fn:function(f){b.sliderChanged(f.getValue())}},change:{fn:function(f){b.sliderChanged(f.getValue())}}}});b.setValue=function(f){if(f!==b.currentValue||b.dimension.size()!==b.currentSize)return b._setValue(f)};b._setValue=function(f){b.currentValue=f;b.currentSize=b.dimension.size();try{if(f==WMJSDateTooEarlyString)b.currentIndex=
0,b.dimensionValueLabel.setValueText(WMJSDateTooEarlyString);else if(f==WMJSDateTooLateString)b.currentIndex=b.dimension.size()-1,b.dimensionValueLabel.setValueText(WMJSDateTooLateString);else if(b.currentIndex=this.dimension.getIndexForValue(f),-1!=b.currentIndex)b.dimensionValueLabel.setValueText(b.getValue());else{var p=parseISO8601DateToDate(f),m=parseISO8601DateToDate(b.dimension.get(0)),k=parseISO8601DateToDate(b.dimension.get(b.dimension.size()-1));p.getTime()<m.getTime()?(b.dimensionValueLabel.setValueText(WMJSDateTooEarlyString),
b.layer.setDimension(b.dimension.name,WMJSDateTooEarlyString),b.currentIndex=0):p.getTime()>k.getTime()?(b.dimensionValueLabel.setValueText(WMJSDateTooLateString),b.layer.setDimension(b.dimension.name,WMJSDateTooLateString),b.currentIndex=b.dimension.size()-1):(b.dimensionValueLabel.setValueText(WMJSDateOutSideRange),b.layer.setDimension(b.dimension.name,WMJSDateOutSideRange))}}catch(l){b.dimensionValueLabel.setValueText(WMJSDateOutSideRange),b.layer.setDimension(b.dimension.name,WMJSDateOutSideRange),
b.currentIndex=0}b.dimSlider.suspendEvents();b.dimSlider.setValue(b.currentIndex,!1);b.dimSlider.resumeEvents()};b.checkReferenceTime=function(f){for(var p=-1,m=-1,k=0;k<b.dimensionPanels.length;k++){var l=b.layer.getDimension(b.dimensionPanels[k].dimension.name);"time"==l.name&&"ISO8601"==l.units&&(m=k);"reference_time"==l.name&&"ISO8601"==l.units&&(p=k)}b.dimSlider.suspendEvents();if(-1!=m&&-1!=p&&(k=b.layer.getDimension(b.dimensionPanels[m].dimension.name),l=b.layer.getDimension(b.dimensionPanels[p].dimension.name),
k.getValue()<l.getValue()))if(b.dimensionPanels[p].dimension.name==f.name){f=k.getValue();do f=k.get(k.getIndexForValue(f)+1);while(f<l.getValue());b.dimensionPanels[m].dimSlider.setValue(k.getIndexForValue(f),!1)}else if(b.dimensionPanels[m].dimension.name==f.name){f=l.getValue();do f=l.get(l.getIndexForValue(f)-1);while(f>l.getValue());b.dimensionPanels[p].dimSlider.setValue(l.getIndexForValue(f),!1)}b.dimSlider.resumeEvents()};b.sliderChanged=function(f){try{b.layer.parentMaps[0].stopAnimating()}catch(p){}b.currentIndex=
f;b.dimensionValueLabel.setValueText(b.getValue());b.layer.setDimension(b.dimension.name,b.getValue());b.layer.draw("DimensionPanel::sliderChanged");isDefined(b.dateTimeWindow)&&b.dateTimeWindow.setDimension(this.dimension)};b.getValue=function(){return b.dimension.get(b.currentIndex)};b.dimensionValueLabel=Ext.create("Ext.form.Label",{cls:"dimensionValueLabel",xtype:"label",region:"center",text:b.getValue()});b.dimensionTitleLabel=Ext.create("Ext.form.Label",{cls:"dimensionTitleLabel",xtype:"label",
region:"center",text:""});b.dimensionPositionLabel=Ext.create("Ext.form.Label",{cls:"dimensionPositionLabel",xtype:"label",region:"center",text:""});b.dimensionValueLabel.setValueText=function(f){if(f==WMJSDateOutSideRange||f==WMJSDateTooEarlyString||f==WMJSDateTooLateString){try{b.dimensionValueLabel.getEl().setStyle("backgroundColor","#FFAAAA")}catch(p){}b.dimensionPositionLabel.setText(" - (-/"+(b.dimension.size()-1+1)+")")}else{try{b.dimensionValueLabel.getEl().setStyle("backgroundColor","white")}catch(p){}b.dimensionPositionLabel.setText(" - ("+
(b.currentIndex+1)+"/"+(b.dimension.size()-1+1)+")")}b.dimensionValueLabel.setText(f);b.dimensionTitleLabel.setText(I18n.dimension.text+" "+b.dimension.name+" in "+b.dimension.units)};b.dimensionValueLabel.setValueText(b.getValue());c=[];c.push(b.dimensionValueLabel);b.dimensionOptionsList=[];if("ISO8601"==b.dimension.units){var e=Ext.create(Ext.button.Button,{xtype:"button",text:"Set time",region:"east",handler:function(){timeselectorWindow.show()}});c.push(e);e=!1;b.layer.name&&-1!=b.layer.name.indexOf("GOME")&&
(e=!0);e&&(e=Ext.create("Ext.data.Store",{fields:[{name:"title",type:"string"},{name:"name",type:"string"}],data:[{title:"No duration",name:""},{title:"1 Second",name:"PT1S"},{title:"10 Seconds",name:"PT10S"},{title:"12 Seconds",name:"PT12S"},{title:"30 Seconds",name:"PT30S"},{title:"1 Minute",name:"PT1M"},{title:"5 Minutes",name:"PT5M"},{title:"10 Minutes",name:"PT10M"},{title:"15 Minutes",name:"PT15M"},{title:"30 Minutes",name:"PT30M"},{title:"60 Minutes",name:"PT1H"},{title:"90 Minutes",name:"PT1H30M"},
{title:"180 Minutes",name:"PT3H"},{title:"360 Minutes",name:"PT6H"},{title:"Daily",name:"P1D"}]}),e=Ext.create("Ext.form.ComboBox",{fieldLabel:"Choose duration",store:e,queryMode:"local",displayField:"title",valueField:"name",region:"center",listeners:{select:function(f,p){b.timeRangeDuration=p[0].get("name");f=b.dimension.getValue();try{f=b.layer.parentMaps[0].getDimension(b.dimension.name).currentValue}catch(m){}-1!=f.indexOf("/")&&(f=f.split("/")[0]);b.dimension.setTimeRangeDuration(b.timeRangeDuration);
b.dimSlider.setMaxValue(b.dimension.size()-1);console.log("Setting value back:"+f);b.layer.setDimension(b.dimension.name,f);b._setValue(f);b.layer.draw("DimensionPanel::sliderChanged")}}}),b.dimensionOptionsList.push(e))}b.dimensionValuePanel={type:"panel",layout:"border",background:"white",bodyStyle:{"background-color":"white"},border:!1,items:c};Ext.apply(this,{margin:"0",padding:"5 3 5 3",border:!1,frame:!1,plain:!0,bodyStyle:{"background-color":"white"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",
height:22,plain:!0,border:!1,layout:"hbox",items:[b.dimensionTitleLabel,b.dimensionPositionLabel]},{xtype:"panel",height:24,margin:"0 0 0 0",frame:!1,border:!1,plain:!0,layout:"border",bodyStyle:{"background-color":"white"},items:[{xtype:"panel",region:"west",width:13,frame:!1,border:!1,layout:"border",items:[{margin:"0 0 0 0",xtype:"checkbox",bodyStyle:{"background-color":"white"},frame:!1,border:!1,plain:!0,checked:b.dimension.linked,handler:function(f,p){b.dimension.linked=p}}]},{xtype:"panel",
region:"center",frame:!1,border:!1,plain:!0,layout:"border",items:[{xtype:"panel",layout:"fit",frame:!1,border:!1,plain:!0,region:"center",items:[b.dimSlider],bodyStyle:{"background-color":"white"}},{xtype:"panel",region:"east",width:40,layout:"hbox",border:!1,frame:!1,bodyStyle:{"background-color":"white"},items:[{xtype:"button",text:"&lt;",width:20,height:22,handler:function(){b.dimSlider.setValue(b.dimSlider.getValue()-1)}},{xtype:"button",text:"&gt;",width:20,height:22,handler:function(){b.dimSlider.setValue(b.dimSlider.getValue()+
1)}}]}]}]},{xtype:"panel",height:22,plain:!0,border:!1,layout:"fit",items:[b.dimensionValuePanel]},{xtype:"panel",plain:!0,border:!1,layout:"fit",items:b.dimensionOptionsList}]});this.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.MapPanel",{extend:"Ext.panel.Panel",alias:"WMJSExtMapPanel",initComponent:function(){var a=this;a.webmapjsid=a.id+"wmjs";a.pointinfobutton=a.id+"pib";a.baseLayer=void 0;Ext.apply(this,{html:'<div id="'+a.webmapjsid+'"/>',layout:"fit",frame:!1,border:!1,margin:0,listeners:{afterlayout:{fn:function(){if(!a.webMapJS){initWMJS();a.webMapJS=new WMJSMap(Ext.fly(a.webmapjsid).dom);a.webMapJS.setWMJSTileRendererTileSettings(WMJSTileRendererTileSettings);a.webMapJS.setBaseURL("./webmapjs/");
a.webMapJS.requestProxy="./webmapjs_php/MakeRequest.php?";for(var b=[],c=0;c<baseLayerConfiguration.length;c++)if(new WMJSLayer(baseLayerConfiguration[c]),0==c){var e=new WMJSLayer(baseLayerConfiguration[c]);a.baseLayer=e;b.push(e);e=new WMJSLayer(baseLayerConfiguration[c]);e.enabled=!1;b.push(e)}else e=new WMJSLayer(baseLayerConfiguration[c]),b.push(e);a.webMapJS.setBaseLayers(b);b=a.getSize();a.webMapJS.setSize(b.width,b.height);a.webMapJS.setProjection(defaultProjection);a.webMapJS.draw("resize event")}}},
resize:{fn:function(b,c,e){isDefined(a.webMapJS)&&(b=a.getSize(),a.webMapJS.setSize(b.width,b.height),a.webMapJS.draw("resize event"))}}}});this.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.ServicePanel",{extend:"Ext.panel.Panel",alias:"WMJSExtServicePanel",initComponent:function(){var a=this;a.store=Ext.create("Ext.data.TreeStore",{root:{text:"Ext JS",id:"src",name:"test",expanded:!0},fields:["text","name"],folderSort:!0,sorters:[{property:"text",direction:"ASC"}]});a.selectedLayerName=a.name;a.tree=Ext.create("Ext.tree.Panel",{store:a.store,hideHeaders:!0,rootVisible:!1,fields:["text","name"],border:0,listeners:{itemclick:{fn:function(b,c,e,f,p,m){a.itemclick&&
(a.selectedLayerName=c.get("name"),1==c.get("leaf")&&a.itemclick(a,a.selectedLayerName,a.service))}}}});a.buildTreeFromNodes=function(b){if(0!=isDefined(a.service)&&0!=a.service.length){a.setLoading("Reading getCapabilities ...");a.WMSService=WMJSGetServiceFromStore(a.service,xml2jsonrequestURL);var c=function(f){a.tree.getRootNode().removeAll();a.tree.getRootNode().appendChild(f);a.setLoading(!1)},e=function(f){error("WMJSExtServicePanel: Unable to do GetCapabilities: "+f);Ext.Msg.alert("WMJSExtServicePanel",
"Exception:\n"+f);a.tree.getRootNode().removeAll();a.setLoading(!1)};try{a.WMSService.getNodes(c,e,b,xml2jsonrequestURL)}catch(f){e(f)}}};Ext.apply(this,{closable:!1,border:!1,layout:"fit",autoScroll:!0,listeners:{afterrender:{fn:function(){a.buildTreeFromNodes()}}},items:[this.tree]});this.superclass.initComponent.apply(this,arguments)}});var webmapjsext_WMJSExt_ServicePanels=[];
Ext.define("webmapjsext.WMJSExt.ServicePanelManager",{extend:"Ext.panel.Panel",alias:"WMJSExtServicePanelManager",requires:["webmapjsext.WMJSExt.ServicePanel"],initComponent:function(){this.getServicePanel=function(a,b){for(var c=0;c<webmapjsext_WMJSExt_ServicePanels.length;c++)if(webmapjsext_WMJSExt_ServicePanels[c].service==a)return webmapjsext_WMJSExt_ServicePanels[c].layerpanel=b,webmapjsext_WMJSExt_ServicePanels[c].window;var e=[];webmapjsext_WMJSExt_ServicePanels.push(e);e.layerpanel=b;e.service=
a;e.servicePanel=Ext.create("webmapjsext.WMJSExt.ServicePanel",{header:!1,constrain:!0,autoDestroy:!1,height:400,service:e.layerpanel.WMJSLayer.service,name:e.layerpanel.WMJSLayer.name,border:0,itemclick:function(f,p){e.layerpanel.setLayer(p)}});e.window=Ext.create("webmapjsext.WMJSExt.WindowFader",{title:I18n.layers.text,autoDestroy:!1,closeAction:"hide",autoScroll:!0,floating:!0,animate:!0,constrain:!0,width:500,items:[e.servicePanel],bbar:[{iconCls:"button_refresh",handler:function(){e.window.refresh()}},
{text:I18n.embed.text,tooltip:"Embed layer view",handler:function(){e.window.hide();e.layerpanel.add(Ext.create("webmapjsext.WMJSExt.ServicePanel",{title:I18n.layers.text,header:!0,collapsible:!0,service:e.layerpanel.WMJSLayer.service,name:e.layerpanel.WMJSLayer.name,border:2,itemclick:function(f,p,m){e.layerpanel.setLayer(p,m)}}))}},{scale:"small",tooltip:I18n.add_new_layer.tooltip,iconCls:"layer_logos button_layerlist_layernew",handler:function(){Ext.create("webmapjsext.WMJSExt.DataPanel",{dataPanelClicked:function(f){e.layerpanel.service=
f.service;e.layerpanel.name=f.layer;e.layerpanel.WMJSLayer.service=e.layerpanel.service;e.layerpanel.WMJSLayer.name=e.layerpanel.name;e.layerpanel.parseLayer(!0,function(p,m){isDefined(f.ready)&&f.ready(b,e.layerpanel.parentWebMapJS)});return b},webMapJS:e.layerpanel.parentWebMapJS}).show()}}]});e.window.refresh=function(){e.servicePanel.buildTreeFromNodes(!0)};return e.window}}});var webmapjsext_WMJSExt_LayerPanel_ServicePanelManager,getServicePanelManager=function(){webmapjsext_WMJSExt_LayerPanel_ServicePanelManager||(webmapjsext_WMJSExt_LayerPanel_ServicePanelManager=Ext.create("webmapjsext.WMJSExt.ServicePanelManager",{}));return webmapjsext_WMJSExt_LayerPanel_ServicePanelManager};
Ext.define("webmapjsext.WMJSExt.LayerPanel",{extend:"Ext.panel.Panel",alias:"WMJSExtLayerPanel",requires:"webmapjsext.WMJSExt.DimensionPanel webmapjsext.WMJSExt.StylePanel webmapjsext.WMJSExt.LayerPropertiesPanel Ext.form.field.Checkbox Ext.form.Label Ext.layout.container.Border Ext.slider.Single Ext.grid.Panel".split(" "),initComponent:function(){var a=this;isDefined(a.opacity)||(a.opacity=1);a.WMJSLayer=new WMJSLayer({service:a.service,name:a.name,style:a.style,opacity:a.opacity,transparent:a.transparent,
enabled:a.enabled});a.opacitySliderChanged=function(b){a.WMJSLayer&&(a.WMJSLayer.setOpacity(b/100),a.opacity=b,0==a.WMJSLayer.enabled?0<b&&(a.WMJSLayer.display(!0),a.hideShowButton.setIconCls("button_layer_visible"),a.WMJSLayer.draw("LayerPanel::Opacity")):0==b&&(a.opacity_backup=100,a.hideShowButton.setIconCls("button_layer_hidden"),a.WMJSLayer.display(!1),a.WMJSLayer.draw("LayerPanel::Opacity")))};a.opacitySlider=Ext.create("Ext.slider.Single",{width:50,useTips:!1,animate:!1,value:100*a.opacity,
minValue:0,maxValue:100,increment:1,tooltip:"transparency",listeners:{drag:{fn:function(b){a.opacitySliderChanged(b.getValue())}},change:{fn:function(b){a.opacitySliderChanged(b.getValue())}}}});a.hideShowButton=Ext.create("Ext.button.Button",{xtype:"button",tooltip:I18n.hide_or_display_layer.tooltip,iconCls:!0===a.WMJSLayer.enabled?"button_layer_visible":"button_layer_hidden",handler:function(b,c){a.WMJSLayer.display(!a.WMJSLayer.enabled);0==a.WMJSLayer.enabled?(this.setIconCls("button_layer_hidden"),
a.opacity_backup=a.opacitySlider.getValue(),a.opacitySlider.setValue(0)):(this.setIconCls("button_layer_visible"),a.opacitySlider.setValue(a.opacity_backup));a.WMJSLayer.draw("LayerPanel::HideShow")}});a.select=function(){for(var b=a.parentPanelList.items,c=0;c<b.getCount();c++)b.get(c).unselect();try{a.getEl().dom.style.border="3px solid #8080FF"}catch(e){}a.selected=!0};a.unselect=function(){try{a.getEl().dom.style.border="3px solid #777"}catch(b){}a.selected=!1};a.setOpacity=function(b){a.opacitySlider.setValue(100*
b);a.opacity=100*b};a.dimCallBackAdded=!1;a.dimensionPanels=[];a.parseLayer=function(b,c){if(0!=isDefined(this.WMJSLayer.service)&&0!=this.WMJSLayer.service.length){a.setLoading("Reading GetCapabilities ...");for(var e=[],f=0;f<a.WMJSLayer.dimensions.length;f++)e.push(this.WMJSLayer.dimensions[f].clone());a.dimensionPanels=[];a.dimUpdate=function(){for(var m=0;m<a.dimensionPanels.length;m++){var k=a.WMJSLayer.getDimension(a.dimensionPanels[m].dimension.name);a.dimensionPanels[m].setValue(k.getValue())}};
a.setDimension=function(m,k){var l=a.getDimensionPanel(m);isDefined(l)?(a.WMJSLayer.setDimension(m,k),l.setValue(k)):error("WMJSExtLayerPanel::Dimension "+m+" not found")};a.getDimensionPanel=function(m){for(var k=0;k<a.dimensionPanels.length;k++)if(a.dimensionPanels[k].dimension.name===m)return a.dimensionPanels[k]};var p=function(m){var k=m;m.message&&(k=m.message);a.setLoading(!1);m="Unable to parse layer "+a.WMJSLayer.name+"\n"+k;a.WMJSLayer.hasError=!0;error(m)};f=function(m){if(void 0!=a.WMJSLayer.parentMaps[0])if(a.WMJSLayer!=
m)isDefined(m)&&p("WMJSExtLayerPanel internal error:\n"+m),c&&c(a),a.afterlayerready&&a.afterlayerready(a);else if(a.WMJSLayer.hasError){a.setLoading(!1);a.productButton.setText(a.WMJSLayer.path+a.WMJSLayer.title);a.styleButton.setText("");var k=a.WMJSLayer.lastError;isDefined(k)||(k="An error occurred connecting to WMS server");a.setTitle(k);error(k);m=new WMJSTimer;k=k.replaceAll("\n","<br/>");m.init(10,function(){Ext.Msg.alert(I18n.unable_to_connect_server.text,I18n.unable_to_connect_server.text+
"<br/><br/>"+k)});c&&c(a);a.afterlayerready&&a.afterlayerready(a)}else{a.WMJSLayer.getLayerRelative(function(g,h,v){a.productButton.setText("("+(h+1)+"/"+v+") "+a.WMJSLayer.title)},function(g){a.productButton.setText(a.WMJSLayer.path+a.WMJSLayer.title)});a.setStyleText(a.WMJSLayer.getStyleObject(a.WMJSLayer.currentStyle));a.dimensionPanels=[];a.dimensionPanelContainer.removeAll();var l="";for(m=0;m<a.WMJSLayer.dimensions.length;m++){for(var t=0;t<e.length;t++)e[t].name==a.WMJSLayer.dimensions[m].name&&
(a.WMJSLayer.dimensions[m].currentValue=e[t].currentValue);t=Ext.create("WMJSExtDimensionPanel",{dimension:a.WMJSLayer.dimensions[m],layer:a.WMJSLayer,dimensionPanels:a.dimensionPanels});a.dimensionPanels.push(t);a.dimensionPanelContainer.add(t);0<l.length&&(l+=", ");l+=a.WMJSLayer.dimensions[m].name}a.afterlayerready&&(c&&c(a),a.afterlayerready(a));a.setLoading(!1);for(m=0;m<a.WMJSLayer.dimensions.length;m++)l=a.WMJSLayer.parentMaps[0].getDimension(a.WMJSLayer.dimensions[m].name),isDefined(l)&&a.WMJSLayer.dimensions[m].setClosestValue(l.currentValue);
for(m=0;m<a.WMJSLayer.dimensions.length;m++)a.dimensionPanels[m].setValue(a.WMJSLayer.dimensions[m].currentValue);a.WMJSLayer.parentMaps[0].rebuildMapDimensions();0==a.dimCallBackAdded&&(a.WMJSLayer.parentMaps[0].addListener("ondimchange",a.dimUpdate,!0),a.dimCallBackAdded=!0);try{a.styleButton.loadStyles()}catch(g){}var q=!1;isDefined(a.name)&&0<a.name.length&&(q=!0);a.setTitle("Layer "+a.WMJSLayer.name);if(!1===q){if(1==a.autoChooseLayer){a.autoChooseLayer=!1;a.WMJSLayer.autoSelectLayer(function(g){a.setLayer(g.name);
a.WMJSLayer.zoomToLayer();q=!0});return}a.productButton.showService()}a.WMJSLayer.WMJSService?a.layerAbstractPanel.update("<span style='margin:5px;display:block;padding:5px;'><b>"+I18n.layer.text+"</b><table class='adagucviewer_wmsjsext_layerpanel_abstract'><tr><td style='width:50px;'><i>"+I18n.title.text+"</i></td><td>"+a.WMJSLayer.title+"</td></tr><tr><td><i>"+I18n.name.text+"</i></td><td>"+a.WMJSLayer.name+"</td></tr><tr><td><i>"+I18n.abstract.text+"</i></td><td>"+a.WMJSLayer.abstract+"</td></tr></table><hr/><b>"+
I18n.service.text+"</b><table class='adagucviewer_wmsjsext_layerpanel_abstract'><tr><td><i>"+I18n.title.text+"</i></td><td> "+a.WMJSLayer.WMJSService.title+"</td></tr><tr><td><i>"+I18n.service.text+"</i></td><td>"+a.WMJSLayer.WMJSService.onlineresource+"</td></tr><tr><td><i>"+I18n.abstract.text+"</i></td><td>"+a.WMJSLayer.WMJSService.abstract+"</td></tr></table></span>"):a.layerAbstractPanel.update("...");m=function(){var g=a.WMJSLayer.parentMaps[0].getLegendGraphicURLForLayer(a.WMJSLayer),h=a.WMJSLayer.parentMaps[0].getLegendStore();
if(a.layerLegendPanel.getEl()){var v=$(a.layerLegendPanel.getEl().dom).find("canvas")[0].getContext("2d");(g=h.getImageForSrc(g))?(v.rect(0,0,90,250),v.fillStyle="white",v.fill(),v.drawImage(g.getElement()[0],0,0)):(v.rect(0,0,90,250),v.fillStyle="gray",v.fill())}};a.WMJSLayer.parentMaps[0].getListener().addToCallback("onlegendready",m,!0);m()}};try{if(a.WMJSLayer.parseLayer(f,b,"LayerPanel::parseLayer",xml2jsonrequestURL),!0===b)try{console.log("clearing cache"),a.WMJSLayer&&a.WMJSLayer.parentMaps&&
0<a.WMJSLayer.parentMaps.length&&(a.WMJSLayer.parentMaps[0].clearImageStore(),a.WMJSLayer.parentMaps[0].loadLegendInline(!0))}catch(m){console.error(m)}}catch(m){p(m)}}};a.duplicateLayer=function(){createNewLayerPanel(a.parentWebMapJS,a.WMJSLayer)};a.productButton=Ext.create("Ext.button.Button",{text:I18n.please_select_product.text,textAlign:"left",iconAlign:"right",iconCls:"button_combobox",tooltip:I18n.select_layer_product_from_service.tooltip,handler:function(b){void 0==a.service||0==a.service.length?
Ext.create("webmapjsext.WMJSExt.DataPanel",{dataPanelClicked:function(c){a.service=c.service;a.name=c.layer;a.WMJSLayer.service=a.service;a.WMJSLayer.name=a.name;a.parseLayer(!0,function(e,f){isDefined(c.ready)&&c.ready(a,a.parentWebMapJS)});return a},webMapJS:a.parentWebMapJS}).show():b.showService()}});a.productButton.showService=function(){var b=getServicePanelManager();a.servicePanelWindow=b.getServicePanel(a.service,a);a.servicePanelWindow.showAt([this.getPosition()[0]+32,this.getPosition()[1]])};
a.styleButton=Ext.create("Ext.button.Button",{text:I18n.default.text,textAlign:"left",iconAlign:"right",iconCls:"button_combobox",tooltip:I18n.change_style_layer.tooltip,handler:function(){a.styleButton.loadStyles();a.stylePanel.showAt([this.getPosition()[0]+32,this.getPosition()[1]])},listeners:{afterrender:{fn:function(){a.stylePanel||(a.stylePanel=Ext.create("webmapjsext.WMJSExt.WindowFader",{title:I18n.available_styles.text,width:650,autoDestroy:!1,closeAction:"hide",items:[Ext.create("WMJSExtStylePanel",
{header:!1,WMJSLayerObject:a.WMJSLayer,border:0,itemclick:function(b,c){a.setStyle(a.WMJSLayer.getStyleObject(c.name))}})]}));a.styleButton.loadStyles=function(){if(a.stylePanel&&(a.stylePanel.getComponent(0).loadStyles(a.WMJSLayer),a.styleButton.setText("default"),0<a.WMJSLayer.currentStyle.length)){var b=a.WMJSLayer.currentStyle;a.styleButton.setText(b);try{a.setStyleText(a.WMJSLayer.getStyleObject(a.WMJSLayer.currentStyle))}catch(c){}}}}}}});a.dimensionPanelContainer=Ext.create("Ext.panel.Panel",
{border:!1,padding:1,collapsed:!1,collapsible:!0,title:I18n.dimensions.text,cls:"WMJSExtLayerPanelDimensionHeader"});a.servicePanelContainer=Ext.create("webmapjsext.WMJSExt.ServicePanel",{title:I18n.layers.text,cls:"WMJSExtLayerPanelDimensionHeader",header:!0,collapsible:!0,collapsed:!0,service:a.WMJSLayer.service,name:a.WMJSLayer.name,border:2,itemclick:function(b,c,e){a.setLayer(c,e)}});a.layerInfoPanelContainer=Ext.create("Ext.panel.Panel",{border:!1,frame:!1,height:35,padding:"3 3 3 3",layout:"border",
items:[{xtype:"panel",region:"center",layout:"fit",border:!1,frame:!1,items:[a.productButton]},{style:{borderColor:"#EEE",borderStyle:"solid",borderWidth:"0px",backgroundColor:"#FFF"},xtype:"panel",region:"east",itemId:"layerinfo",width:40,layout:"hbox",border:!1,frame:!1,padding:"0 0 0 0",items:[{xtype:"button",text:"&lt;",width:20,height:29,handler:function(){a.WMJSLayer.getPreviousLayer(function(b){a.setLayer(b.name)})}},{xtype:"button",text:"&gt;",width:20,height:29,handler:function(){a.WMJSLayer.getNextLayer(function(b){a.setLayer(b.name)})}}]}]});
a.setLayer=function(b,c){a.WMJSLayer.name=b;isDefined(c)&&(a.WMJSLayer.service=c);a.parseLayer();a.WMJSLayer.draw("LayerPanel::setLayer");a.servicePanelWindow&&a.servicePanelWindow.hide();a.stylePanel&&a.styleButton.loadStyles()};a.setStyleText=function(b){0==isDefined(b)?a.styleButton.setText("default"):a.styleButton.setText("("+(b.index+1)+"/"+b.nrOfStyles+") "+b.title)};a.setStyle=function(b){try{a.WMJSLayer.setStyle(b.name)}catch(c){}a.WMJSLayer.draw("LayerPanel::setStyle");a.stylePanel.hide();
a.setStyleText(b)};a.styleInfoPanelContainer=Ext.create("Ext.panel.Panel",{border:!1,frame:!1,height:32,padding:"0 3 3 3",layout:"border",items:[{xtype:"panel",region:"center",layout:"fit",border:!1,frame:!1,items:[a.styleButton]},{style:{borderColor:"#EEE",borderStyle:"solid",borderWidth:"0px",backgroundColor:"#FFF"},xtype:"panel",region:"east",width:40,layout:"hbox",border:!1,frame:!1,items:[{xtype:"button",text:"&lt;",width:20,height:29,handler:function(){a.setStyle(a.WMJSLayer.getStyleObject(a.WMJSLayer.currentStyle,
-1))}},{xtype:"button",text:"&gt;",width:20,height:29,handler:function(){a.setStyle(a.WMJSLayer.getStyleObject(a.WMJSLayer.currentStyle,1))}}]}]});a.animationButton={listeners:{afterrender:{fn:function(b){a.WMJSLayer.parentMaps[0].isAnimating&&b.setIconCls("button_stop_animation");a.WMJSLayer.parentMaps[0].addListener("onstopanimation",function(){b.setIconCls("button_play_animation")},!0);a.WMJSLayer.parentMaps[0].addListener("onstartanimation",function(){b.setIconCls("button_stop_animation")},!0)}}},
scale:"small",iconCls:"button_play_animation",tooltip:I18n.start_or_stop_animation.tooltip,handler:function(b){if(a.WMJSLayer.parentMaps[0].isAnimating)a.WMJSLayer.parentMaps[0].stopAnimating(),b.setIconCls("button_play_animation");else if(b.setIconCls("button_stop_animation"),b=a.WMJSLayer.getDimension("time"),void 0==b)alert(I18n.no_time_dimension_in_layer.text);else{var c=[],e=b.size(),f=e-24,p=e,m=b.getIndexForValue(b.currentValue);m=p-1-m;f-=m;p-=m;0>f&&(p+=-f,f=0);0>p&&(p=0);f>e-1&&(f=e-1);
p>e&&(p=e);for(e=f;e<p;e++)c.push({name:b.name,value:b.getValueForIndex(e)});a.WMJSLayer.parentMaps[0].draw(c)}}};a.moveUp=function(){var b=a.up("panel"),c=b.items.indexOf(a);0<c&&(b.move(c,c-1),a.WMJSLayer.moveUp())};a.moveDown=function(){var b=a.up("panel"),c=b.items.indexOf(a);c<b.items.length-1&&(b.move(c,c+1),a.WMJSLayer.moveDown())};a.layerLegendPanel=Ext.create("Ext.panel.Panel",{xtype:"panel",region:"west",html:"<canvas width=90 height=250></canvas>",border:!1,frame:!1,plain:!0,width:90});
a.layerAbstractPanel=Ext.create("Ext.panel.Panel",{xtype:"panel",region:"center",layout:"fit",autoScroll:!0,border:!1,frame:!1,plain:!0});Ext.apply(this,{margin:"0 0 2 0",frame:!0,plain:!0,padding:"0 0 0 0",collapsible:!1,closable:!0,hideCollapseTool:!1,header:!0,layout:{type:"vbox",align:"stretch"},items:[a.layerInfoPanelContainer,a.styleInfoPanelContainer,a.dimensionPanelContainer,a.servicePanelContainer,{xtype:"panel",layout:"border",frame:!1,border:!1,plain:!0,title:"Service info",cls:"WMJSExtLayerPanelDimensionHeader",
collapsible:!0,collapsed:!0,height:250,region:"center",items:[a.layerAbstractPanel,a.layerLegendPanel]}],bbar:[{xtype:"button",tooltip:I18n.move_layer_up.tooltip,iconCls:"button_layerlist_layerup",handler:function(b,c){a.moveUp()}},{xtype:"button",tooltip:I18n.move_layer_down.tooltip,iconCls:"button_layerlist_layerdown",handler:function(b,c){a.moveDown()}},{iconCls:"button_settings_icon",tooltip:I18n.layer_properties.tooltip,handler:function(b,c){a.propertiesPanel||(a.propertiesPanel=Ext.create("Ext.window.Window",
{title:I18n.properties_for.text+a.WMJSLayer.title,width:600,autoDestroy:!1,closeAction:"hide",layout:"fit",items:[Ext.create("WMJSExtLayerPropertiesPanel",{header:!1,WMJSLayerObject:a.WMJSLayer,border:0,itemclick:function(e,f){}})]}));a.propertiesPanel.showAt(b.getPosition())}},{iconCls:"button_refresh",tooltip:I18n.reload_this_layer.tooltip,handler:function(){isDefined(a.servicePanelWindow)&&a.servicePanelWindow.refresh(!0);a.parseLayer(!0)}},a.animationButton,,{xtype:"tbfill"},{xtype:"label",text:I18n.opacity.text},
a.opacitySlider,a.hideShowButton,{scale:"small",iconCls:"button_zoomfullextent",tooltip:I18n.zoom_to_this_layer.tooltip,handler:function(){a.WMJSLayer.zoomToLayer()}}],listeners:{render:function(b){if(b.header)b.header.on("click",function(){a.select()});a.select()},afterrender:{fn:function(){a.parseLayer()}},beforeclose:function(b){a.WMJSLayer.parentMaps[0].stopAnimating();a.WMJSLayer.remove()}}});this.callParent(arguments);a.parseLayer()}});Ext.define("webmapjsext.WMJSExt.DataPanel",{extend:"Ext.window.Window",alias:"WMJSExtDataPanel",initComponent:function(){var a=this;DataSelectorModel=Ext.define("DataSelectorModel",{extend:"Ext.data.Model",fields:[{name:"title"},{name:"thumbnail"},{name:"service"},{name:"layer"},{name:"style"},{name:"srs"},{name:"bbox"},{name:"baselayerservice"},{name:"baselayername"},{name:"opacity"}]});var b=Ext.create("Ext.data.Store",{model:"DataSelectorModel",data:dataChooserConfiguration}),c=function(e,f){var p=
function(l){l=k.getComponent("AddCustomWMSPanel").getComponent("customwmsurltextarea").getValue();l=WMJScheckURL(l);if(5>l.length)alert("Invalid url given.");else{try{Ext.state.Manager.set("formFieldValues",l)}catch(t){console.log(t)}a.layerPanel=e({service:l,ready:function(t,q){isDefined(t)?t.WMJSLayer.hasError?(new WMJSTimer).init(10,function(){Ext.Msg.alert(I18n.unable_to_connect_server.text,I18n.unable_to_connect_server.text+"<br/><br/>"+layerPanel.WMJSLayer.lastError)}):k.hide():k.hide()}})}},
m=Ext.create("Ext.form.field.Text",{itemId:"customwmsurltextarea",emptyText:I18n.enter_wms_version_url.text,height:25,margin:10,stateful:!0,listeners:{specialkey:function(l,t){t.getKey()==t.ENTER&&p(f)},afterrender:function(l){if(l=Ext.state.Manager.get("formFieldValues"))console.log(l),m.setValue(l)}}});var k=Ext.create("Ext.window.Window",{title:I18n.add_custom_service.text,width:620,height:200,autoDestroy:!0,autoScroll:!1,modal:!0,layout:"border",items:[{xtype:"panel",region:"north",layout:"fit",
border:!1,itemId:"AddCustomWMSPanel",items:[m]},{xtype:"label",margin:10,html:"Add your own WMS version 1.1.1 server address in the box above. For example:<br> https://geoservices.knmi.nl/cgi-bin/RADNL_OPER_R___25PCPRR_L3.cgi? ",region:"center"}],buttons:[{text:I18n.add.text,handler:function(){p(f)}}]});k.show()};a.showCustomWMSWindow=function(){c(a.dataPanelClicked,a.webMapJS)};Ext.apply(this,{title:I18n.add_layers_and_services.text,width:.8*$(window).width(),height:.8*$(window).height(),autoDestroy:!0,
modal:!0,autoScroll:!0,id:"images-view",buttons:[{scale:"large",text:I18n.add_custom_wms_service.text,handler:function(){a.close();c(a.dataPanelClicked,a.webMapJS)}}],items:Ext.create("Ext.view.View",{store:b,tpl:'<tpl for=".">;<div class="thumb-wrap" id="{title}">;<div class="thumb"><img src="{thumbnail}" title="{title}"></div>;<span class="x-editable">{title}</span></div>;</tpl>;<div class="x-clear"></div>'.split(";"),trackOver:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"No images to display",
listeners:{itemclick:function(e,f){a.dataPanelClicked({title:f.get("title"),thumbnail:f.get("thumbnail"),service:f.get("service"),layer:f.get("layer"),srs:f.get("srs"),bbox:f.get("bbox"),style:f.get("style"),baselayerservice:f.get("baselayerservice"),baselayername:f.get("baselayername"),opacity:f.get("opacity")});a.close()}}})});webmapjsext.WMJSExt.DataPanel.superclass.initComponent.apply(this,arguments)}});var defaultBaselayer={service:"https://geoservices.knmi.nl/cgi-bin/worldmaps.cgi?",name:"world_line"};
Ext.define("webmapjsext.WMJSExt.BaseMapSelector",{extend:"Ext.panel.Panel",alias:"WMJSExtBaseMapSelector",requires:["Ext.form.field.Checkbox","Ext.form.Label","Ext.layout.container.Border","Ext.slider.Single","Ext.grid.Panel"],initComponent:function(){var a=this.webmapjsext;OverlaySelectorModel=Ext.define("OverlaySelectorModel",{extend:"Ext.data.Model",fields:[{name:"title"},{name:"enabled",type:"bool"},{name:"type"},{name:"layer",type:"object"},{name:"name"}]});var b=Ext.create("Ext.data.Store",
{model:"OverlaySelectorModel"});Ext.apply(this,{autoScroll:!0,plain:!0,frame:!1,border:!1,bodyCls:"layerlistbg",title:" ",tooltip:I18n.basemaps_overlays.tooltip,iconCls:"button_basemaps32",defaultType:"checkbox",layout:"anchor",items:Ext.create("Ext.grid.Panel",{header:!1,bodyCls:"layerlistbg",autoScroll:!1,plain:!0,frame:!1,border:!1,store:b,columns:[{text:"",dataIndex:"enabled",xtype:"checkcolumn",width:30,listeners:{checkchange:function(c,e,f){b.getAt(e).get("layer").enabled=f;a.webMapJS.draw("WMJSExtMapTypePanel::enableLayer")}}},
{text:I18n.title.text,dataIndex:"title",flex:2},{text:I18n.layer.text,dataIndex:"name",flex:1},{text:I18n.type.text,dataIndex:"type"}],columnLines:!0,iconCls:"icon-grid"}),listeners:{show:{fn:function(){for(var c=[],e=a.webMapJS.getBaseLayers(),f=0;f<e.length;f++){var p=e[f].title;0==f&&(p="Default base layer");c.push({title:p,layer:e[f],name:e[f].name,enabled:e[f].enabled,type:1==e[f].keepOnTop?"overlay":"baselayer"})}b.loadRawData(c)}}}});this.superclass.initComponent.apply(this,arguments)}});defaultBaselayer={service:"https://geoservices.knmi.nl/wms?DATASET=baselayers&",name:"countryborders"};
Ext.define("webmapjsext.WMJSExt.MapTypeSelector",{extend:"Ext.panel.Panel",alias:"WMJSExtMapTypeSelector",requires:["Ext.form.field.Checkbox","Ext.form.Label","Ext.layout.container.Border","Ext.slider.Single","Ext.grid.Panel"],initComponent:function(){var a=this.maptypeclicked;MapTypeSelectorModel=Ext.define("MapTypeSelectorModel",{extend:"Ext.data.Model",fields:[{name:"title"},{name:"bbox"},{name:"srs"},{name:"url"},{name:"baselayer"}]});var b=Ext.create("Ext.data.Store",{model:"MapTypeSelectorModel",
data:mapTypeConfiguration});Ext.apply(this,{id:"maptypeselector",title:" ",tooltip:I18n.predefined_areas.tooltip,iconCls:"button_maptype32",autoScroll:!0,plain:!0,frame:!1,border:!1,baseCls:"layerlistbg",cls:"layerlistbg",items:[Ext.create("Ext.view.View",{title:"Baselayers",plain:!0,frame:!1,border:!1,cls:"layerlistbg",store:b,tpl:'<tpl for=".">;<div class="thumb-wrap" id="{title}">;<div class="thumb"><img src="{url}" title="{title}"></div>;<span class="x-editable">{title}</span></div>;</tpl>;<div class="x-clear"></div>'.split(";"),
trackOver:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"No images to display",prepareData:function(c){var e=[c.bbox[0],c.bbox[1],c.bbox[2],c.bbox[3]];if(1.375<(c.bbox[2]-c.bbox[0])/(c.bbox[3]-c.bbox[1])){var f=(c.bbox[2]-c.bbox[0])/1.375;f=(f-(c.bbox[3]-c.bbox[1]))/2;e[1]=c.bbox[1]-f;e[3]=c.bbox[3]+f}else f=1.375*(c.bbox[3]-c.bbox[1]),f=(f-(c.bbox[2]-c.bbox[0]))/2,e[0]=c.bbox[0]-f,e[2]=c.bbox[2]+f;f=defaultBaselayer.service;var p=defaultBaselayer.name;c.baselayer.service&&
c.baselayer.name&&(f=c.baselayer.service,p=c.baselayer.name);c.url=f+"service=WMS&request=GetMap&styles=&width=160&height=120&format=image/png";c.url+="&layers="+p;c.url+="&version=1.1.1";c.url+="&bbox="+e[0]+","+e[1]+","+e[2]+","+e[3];c.url+="&srs="+c.srs;return c},listeners:{itemclick:function(c,e){a(e)}}})]});this.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.AnimationPanel",{extend:"Ext.panel.Panel",alias:"WMJSExtAnimationPanel",requires:["Ext.form.field.ComboBox","Ext.form.field.Picker","Ext.form.field.Trigger","Ext.layout.container.Form"],initComponent:function(){var a=this,b=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"name"},{type:"string",name:"title"},{type:"object",name:"wmjslayer"}]}),c=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"name"},{type:"object",name:"wmjsdimension"}]}),e=function(){var k=
a.mappanel.webMapJS.getLayers();b.removeAll();for(var l=0;l<k.length;l++)b.add({name:k[l].service+k[l].name,title:k[l].title,wmjslayer:k[l]})},f=function(k){if(isDefined(k)){a.selectedLayer=k;var l=a.getComponent("dimensionpanel").getComponent("dimensioncombobox");l.disable();c.removeAll();for(var t=0;t<k.dimensions.length;t++)c.add({name:k.dimensions[t].name,wmjsdimension:k.dimensions[t]});0<c.getCount()&&(l.setValue(c.getAt(0).get("name")),p(c.getAt(0).get("wmjsdimension")),l.enable())}},p=function(k){isDefined(k)&&
(a.getComponent("dimensionvaluespanel").getComponent("dimensioncurrentvalue").setValue(k.getValue()),a.dimension=k)},m=function(){isDefined(a.dimensionName)&&isDefined(a.currentValue)&&(a.mappanel.webMapJS.stopAnimating(),a.mappanel.webMapJS.setDimension(a.dimensionName,a.currentValue),a.mappanel.webMapJS.draw("AnimationPanel::stop"))};Ext.apply(this,{border:!1,frame:!0,items:[{xtype:"panel",itemId:"layerpanel",layout:"border",frame:!0,border:!1,margin:3,height:36,items:[{margin:3,xtype:"combobox",
itemId:"layercombo",region:"center",fieldLabel:I18n.select_layer.text,labelWidth:110,displayField:"title",valuefield:"name",store:b,queryMode:"local",listeners:{select:{fn:function(k,l){k=l[0].get("wmjslayer");f(k)}}}},{xtype:"button",region:"east",width:23,iconCls:"button_refresh",handler:function(){e()}}]},{xtype:"panel",itemId:"dimensionpanel",layout:"fit",frame:!0,border:!1,margin:3,height:36,items:[{margin:3,xtype:"combobox",itemId:"dimensioncombobox",region:"center",fieldLabel:I18n.select_dimension.text,
labelWidth:110,disabled:!0,store:c,displayField:"name",valuefield:"name",queryMode:"local",listeners:{select:{fn:function(k,l){p(l[0].get("wmjsdimension"))}}}}]},{xtype:"panel",itemId:"dimensionvaluespanel",frame:!0,border:!1,margin:3,layout:"border",height:36,items:[{xtype:"label",text:I18n.start_at.text+":",width:110,region:"west",margin:3},{itemId:"dimensioncurrentvalue",xtype:"textfield",region:"center",frame:!1,border:!1,margin:3},{xtype:"button",region:"east",width:23,iconCls:"button_refresh",
handler:function(){0<b.getCount()&&f(a.selectedLayer)}}]},{xtype:"panel",layout:"border",itemId:"numberofstepspanel",border:!1,frame:!0,height:36,margin:3,items:[{xtype:"label",text:I18n.number_of_steps.text+":",width:110,region:"west",margin:3},{xtype:"numberfield",itemId:"numberofstepsnumberfield",region:"center",value:12}]},{xtype:"panel",layout:"border",itemId:"delaypanel",border:!1,frame:!0,height:36,margin:3,items:[{xtype:"label",text:I18n.delay_ms.text+":",width:110,region:"west",margin:3},
{xtype:"numberfield",itemId:"delaynumberfield",region:"center",value:300}]}],buttons:[{text:I18n.stop.text,handler:m},{text:I18n.start.text,handler:function(){var k=a.getComponent("dimensionvaluespanel").getComponent("dimensioncurrentvalue").getValue(),l=a.getComponent("numberofstepspanel").getComponent("numberofstepsnumberfield").getValue(),t=a.getComponent("delaypanel").getComponent("delaynumberfield").getValue();k=a.dimension.getIndexForValue(k);var q=a.mappanel.webMapJS.getMaxNumberOfAnimations();
l>q&&(l=q,a.getComponent("numberofstepspanel").getComponent("numberofstepsnumberfield").setValue(l));l--;0>l&&(l=0);l=k+l;l>=a.dimension.size()&&(q=a.dimension.size()-(l+1),k+=q,l+=q);0>k&&(k=0);0>l&&(l=0);for(q=[];k<l+1;k++)q.push({name:a.dimension.name,value:a.dimension.getValueForIndex(k)});0==a.mappanel.webMapJS.isAnimating&&(a.dimensionName=a.dimension.name,a.currentValue=a.dimension.currentValue);a.mappanel.webMapJS.setAnimationDelay(t);a.mappanel.webMapJS.draw(q)}}],listeners:{afterrender:{fn:function(){e();
0<b.getCount()&&(a.getComponent("layerpanel").getComponent("layercombo").setValue(b.getAt(0)),f(b.getAt(0).get("wmjslayer")))}},destroy:{fn:function(){m()}}}});webmapjsext.WMJSExt.AnimationPanel.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.PermaLinkPanel",{extend:"Ext.panel.Panel",alias:"WMJSExtPermaLinkPanel",initComponent:function(){var a=this;Ext.apply(this,{border:!1,frame:!0,layout:"fit",items:[{xtype:"panel",layout:"border",frame:!0,border:!1,items:[{frame:!0,border:0,xtype:"panel",height:28,region:"north",html:"<h1>Paste the link below in an email or chat message</h1>"},{xtype:"displayfield",region:"center",itemId:"mainTextField"}]}],listeners:{afterrender:{fn:function(){var b=a.getComponent(0).getComponent("mainTextField");
var c=location.href.split("?")[0];c=c.split("#")[0];-1!=c.indexOf("/index.html")&&(c=c.substring(0,c.indexOf("/index.html")),c+="/");-1!=c.indexOf("/index.jsp")&&(c=c.substring(0,c.indexOf("/index.jsp")),c+="/");-1!=c.indexOf("/index.php")&&(c=c.substring(0,c.indexOf("/index.php")),c+="/");var e=a.mappanel.webMapJS,f=0,p=e.getActiveLayer(),m=e.getLayers();isDefined(void 0)&&(m=[],m.push(void 0));var k=e.getProjection();var l="?srs="+URLEncode(k.srs);l+="&bbox="+URLEncode(k.bbox);if(0<m.length){var t=
[],q=[];for(k=0;k<m.length;k++)if(m[k].name&&m[k].title!=WMJSEmptyLayerName){var g=t.indexOf(m[k].service);-1==g&&(t.push(m[k].service),g=t.length-1);q.push(m[k].name.replace(/,/g,".")+"$"+m[k].format+"$"+m[k].enabled+"$"+m[k].getStyle()+"$"+m[k].opacity+"$"+g);p==m[k]&&(f=k)}p=URLEncode(t[0]);for(k=1;k<t.length;k++)p+=","+URLEncode(t[k]);l+="&service="+p;p=URLEncode(q[0]);for(k=1;k<q.length;k++)p+=","+URLEncode(q[k]);l=l+("&layer="+p)+("&selected="+f);f=e.getDimensionList();isDefined(void 0)&&(f=
(void 0).dimensions);if(0<f.length)for(l+="&dims=",k=0;k<f.length;k++)0<k&&(l+=","),l+=f[k].name+"$"+f[k].currentValue}e.isMapPinVisible();e=e.getBaseLayers();f="";for(k=0;k<e.length;k++)e[k].enabled&&(0<f.length&&(f+="$"),f+=URLEncode(e[k].name));""==f&&(f="none");c+=l+("&baselayers="+f);b.setValue('<a href="'+c+'" target="_blank">'+c+" </a>")}}}});webmapjsext.WMJSExt.PermaLinkPanel.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.SpinnerSlider",{extend:"Ext.panel.Panel",alias:["widget.spinnerslider"],requires:["Ext.slider.Single"],initComponent:function(){var a=this;a.slidertitle=a.title;a.title=void 0;a.setValue=function(b){a.slider.suspendEvents();a.slider.setValue(b);a.slider.resumeEvents();a.label.setText(""+decimalFormatter(b,a.ndecs))};a.getValue=function(){return a.slider.getValue()};a.setValueByEvent=function(b){a.setValue(b);a.trigger&&a.trigger(b)};Ext.apply(this,{border:!1,height:15,
margin:"8 5 8 5",frame:!1,layout:"border",items:[{xtype:"panel",region:"west",width:44,border:!1,items:[{xtype:"label",text:a.slidertitle}]},{xtype:"panel",region:"center",layout:"fit",border:!1,items:[{xtype:"slider",useTips:!1,animate:!1,minValue:a.min,maxValue:a.max,itemId:"slider",margin:"0 4 0 4",listeners:{drag:{fn:function(b){a.setValueByEvent(b.getValue())}},change:{fn:function(b){a.setValueByEvent(b.getValue())}}}}]},{xtype:"panel",layout:"border",border:!1,frame:!1,region:"east",width:75,
bodyStyle:{"background-color":"white"},items:[{region:"west",scale:"small",xtype:"button",text:"&lt;",width:20,handler:function(){a.setValueByEvent(a.queryById("slider").getValue()-1)}},{xtype:"label",itemId:"label",region:"center",cls:"test-lbl-text-align"},{region:"east",scale:"small",xtype:"button",text:"&gt;",width:20,handler:function(){a.setValueByEvent(a.queryById("slider").getValue()+1)}}]}]});this.superclass.initComponent.apply(this,arguments);this.label=this.queryById("label");this.slider=
this.queryById("slider")}});
Ext.define("Ext.ux.form.field.DateTime",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},alias:"widget.datetimefield",layout:{type:"vbox",align:"stretch"},border:!1,width:220,msgTarget:"side",dateCfg:{},timeCfg:{},initComponent:function(){this.buildField(this);this.callParent();this.dateField=this.down("datefield");this.timeField=this.down("timefield");this.initField();this.yearslider=this.queryById("yearslider");this.monthslider=this.queryById("monthslider");this.dayslider=
this.queryById("dayslider");this.hourslider=this.queryById("hourslider");this.minuteslider=this.queryById("minuteslider");this.secondslider=this.queryById("secondslider")},buildField:function(a){_this=this;_this.slidersTriggered=function(){var b=new Date(Date.UTC(_this.yearslider.getValue(),_this.monthslider.getValue()-1,_this.dayslider.getValue(),_this.hourslider.getValue(),_this.minuteslider.getValue(),_this.secondslider.getValue()));_this.setValue(b);_this.triggerEvent()};this.items=[{xtype:"panel",
border:!1,layout:{type:"hbox"},items:[{xtype:"datefield",format:"Y-m-d",validateOnChange:!0,validateOnBlur:!0,validateBlank:!1,emptyText:"yyyy-mm-dd",anchor:"100%",maskRe:/^([0-9]|-)$/,width:110,listeners:{change:{fn:function(b,c){a.datePart=c;a.triggerEvent()}}}},{xtype:"timefield",format:"H:i:s UTC",width:110,listeners:{change:{fn:function(b,c){a.timePart=c;a.triggerEvent()}}}}]},{xtype:"panel",border:!1,items:[{xtype:"spinnerslider",title:"Year",itemId:"yearslider",min:parseISO8601DateToDate(_this.minTimeValue).getUTCFullYear(),
max:parseISO8601DateToDate(_this.maxTimeValue).getUTCFullYear(),ndecs:4,trigger:_this.slidersTriggered},{xtype:"spinnerslider",title:"Month",itemId:"monthslider",min:1,max:12,ndecs:2,trigger:_this.slidersTriggered},{xtype:"spinnerslider",title:"Day",itemId:"dayslider",min:1,max:31,ndecs:2,trigger:_this.slidersTriggered},{xtype:"spinnerslider",title:"Hour",itemId:"hourslider",min:0,max:23,ndecs:2,trigger:_this.slidersTriggered},{xtype:"spinnerslider",title:"Minute",itemId:"minuteslider",min:0,max:59,
ndecs:2,trigger:_this.slidersTriggered},{xtype:"spinnerslider",title:"Second",itemId:"secondslider",min:0,max:59,ndecs:2,trigger:_this.slidersTriggered}]}]},triggerEvent:function(){if(0!=_this.triggerEvents&&this.datePart&&this.timePart)try{var a=decimalFormatter(this.datePart.getFullYear(),4)+"-"+decimalFormatter(this.datePart.getMonth()+1,2)+"-"+decimalFormatter(this.datePart.getDate(),2)+"T"+decimalFormatter(this.timePart.getUTCHours(),2)+":"+decimalFormatter(this.timePart.getUTCMinutes(),2)+":"+
decimalFormatter(this.timePart.getUTCSeconds(),2)+"Z",b=parseISO8601DateToDate(a);this.setValue(b);this.fireEvent("change",this,b)}catch(c){}},getValue:function(){var a=this.dateField.getSubmitValue(),b=this.timeField.getSubmitValue();if(a)if(b){var c=this.getFormat();c=Ext.Date.parse(a+" "+b,c)}else c=this.dateField.getValue();return c},setValue:function(a){_this.suspendEvents();_this.triggerEvents=!1;if(isDefined(a)&&a!=_this.currentValue){_this.currentValue=a;var b=parseISO8601DateToDate(_this.minTimeValue),
c=parseISO8601DateToDate(_this.maxTimeValue);a<b&&(a=b);a>c&&(a=c);b=a.getUTCFullYear();_this.dateField.setValue(new Date(Date.UTC(b,a.getUTCMonth(),a.getUTCDate(),0,0,0)));_this.yearslider.setValue(a.getUTCFullYear());_this.monthslider.setValue(a.getUTCMonth()+1);_this.dayslider.setValue(a.getUTCDate());_this.hourslider.setValue(a.getUTCHours());_this.minuteslider.setValue(a.getUTCMinutes());_this.secondslider.setValue(a.getUTCSeconds());_this.timeField.setValue(a)}_this.triggerEvents=!0;_this.resumeEvents()}});Ext.define("webmapjsext.WMJSExt.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",constructor:function(){this.addEvents("checkchange");this.callParent(arguments)},processEvent:function(a,b,c,e,f,p){if("mousedown"==a||"keydown"==a&&(p.getKey()==p.ENTER||p.getKey()==p.SPACE)){var m=b.panel.store.getAt(e),k=this.dataIndex,l=!m.get(k);m.set(k,l);this.fireEvent("checkchange",this,e,l);return!1}return this.callParent(arguments)},renderer:function(a){var b=Ext.baseCSSPrefix,c=[b+"grid-checkheader"];
a&&c.push(b+"grid-checkheader-checked");return'<div class="'+c.join(" ")+'">&#160;</div>'}});Ext.define("webmapjsext.WMJSExt.IFramePanel",{extend:"Ext.Panel",src:"about:blank",loadingText:"Loading ...",initComponent:function(){this.updateHTML();this.callParent(arguments)},updateHTML:function(){this.html='<iframe id="iframe-'+this.id+'" style="overflow:auto;width:100%;height:100%;" frameborder="0"  src="'+this.src+'"></iframe>'},reload:function(){this.setSrc(this.src)},getIframeId:function(){return"iframe-"+this.id},reset:function(){var a=this.getDOM(),b=a.parentNode;a&&b&&(a.src="about:blank",
a.parentNode.removeChild(a));a=document.createElement("iframe");a.frameBorder=0;a.src=this.src;a.id="iframe-"+this.id;a.style.overflow="auto";a.style.width="100%";a.style.height="100%";b.appendChild(a)},setSrc:function(a,b){this.src=a;if(b=this.getDOM())b.src=a},getSrc:function(){return this.src},getDOM:function(){return document.getElementById("iframe-"+this.id)},getDocument:function(){var a=this.getDOM();a=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument;
return a.document},destroy:function(){var a=this.getDOM();a&&a.parentNode&&(a.src="about:blank",a.parentNode.removeChild(a));this.callParent(arguments)},update:function(a){this.setSrc("about:blank");try{var b=this.getDocument();b.open();b.write(a);b.close()}catch(c){this.reset(),b=this.getDocument(),b.open(),b.write(a),b.close()}}});Ext.define("webmapjsext.WMJSExt.WCSPanel",{extend:"Ext.panel.Panel",alias:"WCSPanel",initComponent:function(){var a=new function(){this.bbox=this.srs=void 0;this.coverages=[]};a.srs=this.WMJSLayer.parentMaps[0].getProjection().srs;a.bbox=this.WMJSLayer.parentMaps[0].getProjection().bbox.toString();var b=new WMJSCoverage({service:this.WMJSLayer.WMJSService.service,name:this.WMJSLayer.name});a.coverages.push(b);b.dimensions=this.WMJSLayer.dimensions;var c="EPSG:4326",e="AAIGRID",f="-180,-90,180,90",
p=Ext.create("Ext.data.Store",{fields:["title","srs","bbox"],data:{items:[]},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),m=Ext.create("Ext.grid.Panel",{border:!1,store:p,columns:[{text:"Title",dataIndex:"title",flex:1},{text:"ESPG Code",dataIndex:"srs"}],listeners:{select:{fn:function(n,u){n=u.get("bbox");c=u.get("srs");f=n;t.getComponent("column2").getComponent("areaPanel").getComponent("bboxtop").setValue(n.split(",")[3]);t.getComponent("column2").getComponent("areaPanel").getComponent("bbox").getComponent("bboxwest").setValue(n.split(",")[0]);
t.getComponent("column2").getComponent("areaPanel").getComponent("bbox").getComponent("bboxeast").setValue(n.split(",")[2]);t.getComponent("column2").getComponent("areaPanel").getComponent("bboxbottom").setValue(n.split(",")[1]);u=Math.abs(f.split(",")[2]-f.split(",")[0]);n=Math.abs(f.split(",")[3]-f.split(",")[1]);var x=a.coverages[0];t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("xresolution").setValue(u/x.width);t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("yresolution").setValue(n/
x.height);r()}}}}),k=Ext.create("Ext.data.Store",{fields:["title","format"],data:{items:[]},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),l=Ext.create("Ext.grid.Panel",{border:!1,store:k,columns:[{text:I18n.format.text,dataIndex:"format"},{text:I18n.title.text,dataIndex:"title",flex:1}],listeners:{select:{fn:function(n,u){e=u.get("format");r()}}}});a.onReady=function(){m.setLoading(!1);for(var n=this.coverages[0],u=0;u<n.supportedProjections.length;u++){var x=n.supportedProjections[u].srs;
try{x=epsgDescriptionLookup[n.supportedProjections[u].srs]}catch(y){}isDefined(x)||(x=n.supportedProjections[u].srs);p.add({title:x,srs:n.supportedProjections[u].srs,bbox:n.supportedProjections[u].bbox})}u=p.find("srs",n.nativeCRS);-1==u&&(u=p.find("srs","EPSG:4326"));-1==u&&(u=0);m.getView().select(u);p.add({title:"Viewer window projection and area",srs:this.srs,bbox:this.bbox});t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterwidth").setValue(n.width);
t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterheight").setValue(n.height);x=t.getComponent("column3").getComponent("dimensionPanel");for(u=0;u<n.dimensions.length;u++)x.add({xtype:"textfield",fieldLabel:n.dimensions[u].name,value:n.dimensions[u].currentValue,labelWidth:40,padding:"30",width:200,itemId:"dimtextfield_"+n.dimensions[u].name,listeners:{change:{fn:function(){r()}}}});for(u=0;u<n.formats.length;u++){x=n.formats[u];var w=n.formats[u].toUpperCase();
try{x=formatDescriptionLookup[w]}catch(y){}isDefined(x)||(x=n.formats[u]);k.add({title:x,format:n.formats[u]});"AAIGRID"==w&&l.getView().select(u)}r();v.update('<table style="margin:5px;"><tr><td><b>Coverage:</b></td><td>'+n.name+"</td></tr><tr><td><b>Title:</b></td><td>"+n.title+"</td></tr><tr><td><b>Description:</b></td><td>"+n["abstract"]+"</td></tr></table>")};Ext.create("Ext.panel.Panel",{region:"west",border:!0,width:100});var t=Ext.create("Ext.panel.Panel",{region:"center",border:!1,layout:{type:"hbox",
align:"stretch"},defaults:{border:!0},items:[{xtype:"panel",flex:2,title:I18n.coordinate_reference_system.text,itemId:"projectionPanel",layout:"fit",items:[m],border:!0,split:!0},{xtype:"panel",layout:"border",itemId:"column2",split:!0,autoScroll:!0,border:!1,flex:1,items:[{itemId:"areaPanel",height:"50%",xtype:"panel",title:I18n.area_bounding_box.text,region:"center",autoScroll:!0,layout:{type:"vbox",columns:3},items:[{xtype:"textfield",fieldLabel:I18n.north.text,itemId:"bboxtop",labelWidth:20,padding:"30 5 5 130",
width:180,listeners:{change:{fn:function(){r()}}}},{xtype:"panel",itemId:"bbox",border:!1,layout:"hbox",items:[{xtype:"textfield",fieldLabel:I18n.west.text,itemId:"bboxwest",labelWidth:30,padding:"15 0 0 15",width:180,listeners:{change:{fn:function(){r()}}}},{xtype:"textfield",fieldLabel:I18n.east.text,itemId:"bboxeast",labelWidth:30,padding:"15 0 0 15",width:180,listeners:{change:{fn:function(){r()}}}}]},{xtype:"textfield",fieldLabel:I18n.south.text,itemId:"bboxbottom",labelWidth:40,padding:"15 5 5 110",
width:200,listeners:{change:{fn:function(){r()}}}}]},{xtype:"panel",region:"south",height:"50%",title:"Grid properties",split:!0,autoScroll:!0,itemId:"gridproperties",items:{xtype:"fieldcontainer",itemId:"field",items:[{xtype:"radiofield",boxLabel:"Cell size",name:"resolution",checked:!0,itemId:"radioselectcellsize",padding:"15 15 15 15",handler:function(n,u){!0===u&&(t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterwidth").disable(),t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterheight").disable(),
t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("xresolution").enable(),t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("yresolution").enable());r()}},{xtype:"textfield",fieldLabel:"X resolution",padding:"0 0 0 40",itemId:"xresolution",width:170,listeners:{change:{fn:function(){r()}}}},{xtype:"textfield",fieldLabel:"Y resolution",padding:"0 0 0 40",itemId:"yresolution",width:170,listeners:{change:{fn:function(){r()}}}},
{xtype:"radiofield",boxLabel:"Raster size",name:"resolution",padding:15,handler:function(n,u){!0===u&&(t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterwidth").enable(),t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterheight").enable(),t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("xresolution").disable(),t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("yresolution").disable())}},
{xtype:"textfield",fieldLabel:"Raster Width",padding:"0 0 0 40",disabled:!0,itemId:"rasterwidth",width:170,listeners:{change:{fn:function(){r()}}}},{xtype:"textfield",fieldLabel:"Raster Height",padding:"0 0 0 40",disabled:!0,itemId:"rasterheight",width:170,listeners:{change:{fn:function(){r()}}}}]}}]},{itemId:"column3",xtype:"panel",layout:"border",border:!1,split:!0,flex:1,items:[{xtype:"panel",region:"center",height:"50%",itemId:"dimensionPanel",title:I18n.dimensions.text,autoScroll:!0},{xtype:"panel",
split:!0,autoScroll:!0,region:"south",height:"50%",title:I18n.formats.text,items:[l]}]}]}),q=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:!0,width:300,items:[t]}),g=Ext.create("Ext.panel.Panel",{border:!1,padding:20}),h=Ext.create("Ext.panel.Panel",{title:"GetCoverage request link",region:"south",border:!0,height:100,layout:"fit",items:[g]}),v=Ext.create("Ext.panel.Panel",{region:"north",border:!1,height:80,frame:!1});Ext.apply(this,{layout:"border",padding:0,frame:!1,border:!0,
items:[q,v,h]});m.setLoading(!0);var r=function(){var n=a.coverages[0].service;n=WMJScheckURL(n);var u=a.coverages[0].name,x=t.getComponent("column2").getComponent("areaPanel").getComponent("bbox").getComponent("bboxwest").getValue()+","+t.getComponent("column2").getComponent("areaPanel").getComponent("bboxbottom").getValue()+","+t.getComponent("column2").getComponent("areaPanel").getComponent("bbox").getComponent("bboxeast").getValue()+","+t.getComponent("column2").getComponent("areaPanel").getComponent("bboxtop").getValue();
-1==n.indexOf("?")?n+="?":"&"!=n.charAt(n.length-1)&&(n+="&");n=n+"SERVICE=WCS&REQUEST=GetCoverage&COVERAGE="+u+"&CRS="+URLEncode(c)+"&FORMAT="+e+"&BBOX="+x;1==t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("radioselectcellsize").getValue()?(n+="&RESX="+t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("xresolution").getValue(),n+="&RESY="+t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("yresolution").getValue()):
(n+="&WIDTH="+t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterwidth").getValue(),n+="&HEIGHT="+t.getComponent("column2").getComponent("gridproperties").getComponent("field").getComponent("rasterheight").getValue());for(u=0;u<a.coverages[0].dimensions.length;u++)try{var w=t.getComponent("column3").getComponent("dimensionPanel").getComponent("dimtextfield_"+a.coverages[0].dimensions[u].name).getValue(),y=a.coverages[0].dimensions[u].name;y=y.toUpperCase();
"ELEVATION"!=y&&"TIME"!=y&&(y="DIM_"+y);n+="&"+y+"="+w}catch(A){}g.update('<a target="_blank" href="'+n+'">'+n+"</a>");return c};WCJSRequest(a.coverages[0].service,a.coverages[0].name,function(n){a.coverages[0]=parseDescribeCoverage(n,b);a.onReady()},function(n){alert("failed:\n "+n)});webmapjsext.WMJSExt.WCSPanel.superclass.initComponent.apply(this,arguments)}});Ext.define("webmapjsext.WMJSExt.WindowFader",{extend:"Ext.window.Window",alias:"WMJSExtWindowFader",requires:[],initComponent:function(){var a=this;a.timer=new WMJSTimer;a.fadeOut=function(){100!=a.opacity&&(0<a.opacity?(a.timer.init(50,a.fadeOut),a.opacity-=(100-a.opacity)/10+.5,a.getEl().dom.style.opacity=a.opacity/100):a.close())};Ext.apply(this,{listeners:{render:{fn:function(){a.el.on("mouseenter",function(){a.getEl().dom.style.opacity="1";a.opacity=100});a.el.on("mouseleave",function(){a.opacity=
95;a.timer.init(100,a.fadeOut)})}},show:{fn:function(){a.getEl().dom.style.opacity=1;a.opacity=100}}}});this.callParent(arguments)}});initWMJS();var error=function(a){console.error(a)},debug=function(a){console.log(a)},versionInfo="ADAGUC viewer version 4.2.0.",mainWebmapJS;function decimalFormatter(a,b){a=parseInt(a)+"";b=parseInt(b)-a.length;var c,e="";for(c=0;c<b;c++)e+="0";return e+a}
function Console(a){function b(f){f=(f+"").replace(/&/g,"&amp;");f=f.replace(/</g,"&lt;");f=f.replace(/>/g,"&gt;");f=f.replace(/"/g,"&quot;");return f=f.replace(/\n/g,"<br>")}var c=a,e="";this.println=function(f,p){e=0==p?e+("<p class='stdoutmessage'>"+f+"</p>"):e+("<p class='stdoutmessage'>"+b(f)+"</p>");isDefined(c)&&(c.innerHTML=e,c.scrollTop=c.scrollHeight);17824<e.length&&(e=e.substring(e.length-13368))};this.errprintln=function(f,p){e=0==p?e+("<p class='stderrmessage'>"+f+"</p>"):e+("<p class='stderrmessage'>"+
b(f)+"</p>");isDefined(c)&&(c.innerHTML=e,c.scrollTop=c.scrollHeight)};this.cls=function(){e="";isDefined(c)&&(c.innerHTML=e)};this.setSize=function(f,p){isDefined(c)&&(c.scrollTop=c.scrollHeight,c.style.width=f+"px",c.style.height=p+"px",c.width=f+"px",c.height=p+"px")};this.setElement=function(f){c=f;initWMJS();isDefined(c)&&(c.style.overflow="scroll",c.style.display="inline-block",c.style.position="absolute",c.style.width="100%",c.style.height="100%",c.style.font="normal 12px courier",c.noWrap=
!0,c.style.whiteSpace="nowrap",c.innerHTML=e,c.scrollTop=c.scrollHeight)};this.setElement(a)}
var myUTCDateParser=function(a,b){a=parseISO8601DateToDate(a+"T00:00:00Z");a.add(parseISO8601IntervalToDateInterval("P0D"));return a},myUTCDateFormatter=function(){if(void 0!=this)return decimalFormatter(this.getFullYear(),4)+"-"+decimalFormatter(this.getMonth()+1,2)+"-"+decimalFormatter(this.getDate(),2)},myUTCTimeFormatter=function(){if(void 0!=this)return decimalFormatter(this.getUTCHours(),2)+":"+decimalFormatter(this.getUTCMinutes(),2)+":"+decimalFormatter(this.getUTCSeconds(),2)},myUTCTimeParser=
function(a,b){return parseISO8601DateToDate("2000-01-01T"+a+"Z")};Ext.Date.formatFunctions["Y-m-d UTC"]=myUTCDateFormatter;Ext.Date.parseFunctions["Y-m-d UTC"]=myUTCDateParser;Ext.Date.formatFunctions["H:i:s UTC"]=myUTCTimeFormatter;Ext.Date.parseFunctions["H:i:s UTC"]=myUTCTimeParser;Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:new Date((new Date).getTime()+6048E5)}));
var firstTimeOpening=!1,clearLayers=function(a){Ext.getCmp("layerlistpanel").removeAll();a.removeAllLayers()},updateLayers=function(){for(var a=Ext.getCmp("layerlistpanel").items,b=0;b<a.getCount();b++)a.get(b).parseLayer(!0)},getLayerObjects=function(){for(var a=[],b=Ext.getCmp("layerlistpanel").items,c=0;c<b.getCount();c++)a.push(b.get(c));return a},getSelectedLayer=function(){for(var a=getLayerObjects(),b=0;b<a.length;b++)if(1==a[b].selected)return a[b]},removeLayer=function(){for(var a=getLayerObjects(),
b=-2,c=0;c<a.length;c++)if(1==a[c].selected){b=c-1;a[c].close();break}a=getLayerObjects();0<a.length&&-2!=b&&(0>b&&(b=0),b>a.length-1&&(b=a.length-1),a[b].select())},createNewLayerPanel=function(a,b){0==isDefined(b)&&(b=[]);var c=void 0;isDefined(b.service)&&(c=b.service);var e=void 0;isDefined(b.name)&&(e=b.name);var f=void 0;isDefined(b.style)&&(f=b.style);var p=void 0;isDefined(b.opacity)&&0<(""+b.opacity).length&&(p=b.opacity);var m=void 0;isDefined(b.enabled)&&(m=b.enabled);var k=void 0;isDefined(b.autoChooseLayer)&&
(k=b.autoChooseLayer);isDefined(m)||(m=!0);var l=Ext.getCmp("layerlistpanel");l.removeLayer=removeLayer;c=Ext.create("webmapjsext.WMJSExt.LayerPanel",{parentPanelList:l,title:e,service:c,name:e,style:f,opacity:p,enabled:m,autoChooseLayer:k,parentWebMapJS:a,afterlayerready:function(t){1!=t.layerAddedToWebMapJS&&(t.WMJSLayer.enabled=this.enabled,t.layerAddedToWebMapJS=!0);b.ready?(b.ready(t,a),b.ready=void 0):(1==b.zoomtolayer&&(b.zoomtolayer=!1,a.setProjection(t.WMJSLayer.getProjection("EPSG:4326"))),
a.draw("createNewLayerPanel"),1==b.notifyadded&&(b.notifyadded=!1))}});c.WMJSLayer.enabled=!1;a.addLayer(c.WMJSLayer);l.insert(0,c);c.select();return c},timeselectorWindow=Ext.create("Ext.window.Window",{title:"Time selection",width:310,height:624,constrain:!0,autoDestroy:!1,collapsible:!0,frame:!1,plain:!0,border:!1,closeAction:"hide",html:"<div class='timeselector'/>",listeners:{afterrender:{fn:function(a){var b=new WMJSTimeSelector($(this.getEl().dom).find(".timeselector"),function(c){mainWebmapJS.webMapJS.setDimension("time",
c);mainWebmapJS.webMapJS.draw("timeselectorWindow")});mainWebmapJS.webMapJS.addListener("onmapdimupdate",function(){b.dimensionUpdate(mainWebmapJS.webMapJS)},!0);mainWebmapJS.webMapJS.addListener("ondimchange",function(){b.dimensionChange(mainWebmapJS.webMapJS)},!0);mainWebmapJS.webMapJS.addListener("onimageload",function(){b.loadingComplete(mainWebmapJS.webMapJS)},!0);b.dimensionUpdate(mainWebmapJS.webMapJS)}},show:{fn:function(){mainWebmapJS.webMapJS.stopAnimating()}}}}),timeselectorPanel=Ext.create("Ext.panel.Panel",
{iconCls:"button_time32",title:" ",bodyCls:"layerlistbg",autoDestroy:!1,collapsible:!1,frame:!1,plain:!0,border:!1,closeAction:"hide",html:"<div class='timeselector layerlistbg'/>",listeners:{afterrender:{fn:function(a){var b=new WMJSTimeSelector($(this.getEl().dom).find(".timeselector"),function(c){mainWebmapJS.webMapJS.setDimension("time",c);mainWebmapJS.webMapJS.draw("timeselectorPanel")});mainWebmapJS.webMapJS.addListener("onmapdimupdate",function(){b.dimensionUpdate(mainWebmapJS.webMapJS)},!0);
mainWebmapJS.webMapJS.addListener("ondimchange",function(){b.dimensionChange(mainWebmapJS.webMapJS)},!0);mainWebmapJS.webMapJS.addListener("onimageload",function(){b.loadingComplete(mainWebmapJS.webMapJS)},!0);b.dimensionUpdate(mainWebmapJS.webMapJS)}},show:{fn:function(){mainWebmapJS.webMapJS.stopAnimating()}}}});
Ext.onReady(function(){Ext.tip.QuickTipManager.init();mainWebmapJS=Ext.create("webmapjsext.WMJSExt.MapPanel",{region:"center",border:!0});var a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{3}))?(Z|[\+-]\d{2}(?::\d{2})?)$/;Ext.create("Ext.form.field.Text",{value:"1000-01-01T00:00:00Z",regex:a,regexText:"Format should be YYYY-MM-DDThh:mm:ssZ"});Ext.create("Ext.form.field.Text",{value:"3000-01-01T00:00:00Z",regex:a,regexText:"Format should be YYYY-MM-DDThh:mm:ssZ"});var b=Ext.create("Ext.panel.Panel",
{region:"east",collapsible:!0,closable:!0,split:!0,header:!1,hidden:!0,width:600,autoScroll:!1,layout:"fit",title:"test",tbar:[{xtype:"label",text:"App",scale:"large",itemId:"paneltitle"},{xtype:"tbfill",scale:"large"},{xtype:"tool",scale:"large",type:"close",handler:function(){b.hide()}}],listeners:{show:{fn:function(){b.getDockedComponent(0).getComponent("paneltitle").setText("App '"+b.applicationSettings.name||b.applicationSettings.title+"'");b.update('<div id="webmapjs_customapplication" class="webmapjs_customapplication"></div>');
var g=WMJSExtApplications[b.applicationSettings.name];g?(b.applicationSettings.app=new g($("#webmapjs_customapplication"),mainWebmapJS.webMapJS),b.applicationSettings.app.enable(b.width,mainWebmapJS.webMapJS.getHeight()-24)):alert("Application with name "+b.applicationSettings.name+" not registered")}},hide:{fn:function(){b.applicationSettings.app&&(b.applicationSettings.app.disable(),b.applicationSettings.app=void 0);mainWebmapJS.webMapJS.enableInlineGetFeatureInfo(!0);mainWebmapJS.webMapJS.removeListener("mouseclicked")}},
resize:{fn:function(){b.applicationSettings.app&&b.applicationSettings.app.resize(b.width,mainWebmapJS.webMapJS.getHeight())}}},setApplication:function(g){try{b&&b.applicationSettings&&b.applicationSettings.app&&b.applicationSettings.app.disable()}catch(h){}b.applicationSettings=g}});a=Ext.create("Ext.panel.Panel",{region:"center",layout:"border",split:!0,frame:!1,border:!1,margin:0,items:[mainWebmapJS,b]});var c=function(g){var h=createNewLayerPanel(mainWebmapJS.webMapJS,{service:g.service,name:g.layer,
style:g.style,opacity:g.opacity,ready:function(v,r){var n=g.srs,u=g.bbox,x=g.baselayername,w=g.baselayerservice;n&&!u?r.setProjection(v.getProjection(n)):n&&u&&r.setProjection({srs:n,bbox:u});x&&w?(mainWebmapJS.baseLayer.setService(w),mainWebmapJS.baseLayer.name=x,mainWebmapJS.baseLayer.parseLayer(function(){r.draw("dataPanelClicked::parseLayer")},void 0,"WMJSExtMain::dataPanelClicked")):r.draw("dataPanelClicked");isDefined(h)&&isDefined(g.ready)&&(g.ready(h,r),1==h.WMJSLayer.hasError&&h.close())}});
return h},e,f=new Console;Ext.create("Ext.panel.Panel",{html:'<div id="debuginfodiv"></div>',layout:"fit",listeners:{afterrender:{fn:function(){f.setElement(document.getElementById("debuginfodiv"))}}}});var p=[{text:I18n.show_time_selection_window.text,iconCls:"button_settings_icon",handler:function(){timeselectorWindow.show()}},{text:I18n.create_animation.text+"&hellip;",iconCls:"button_settings_icon",handler:function(){Ext.create("Ext.window.Window",{title:I18n.create_animation.text,width:460,height:300,
layout:"form",autoDestroy:!0,closeAction:"destroy",autoScroll:!0,collapsible:!0,items:[Ext.create("webmapjsext.WMJSExt.AnimationPanel",{mappanel:mainWebmapJS})]}).show()}},{text:I18n.create_link.text,iconCls:"button_makeLink",handler:function(){e=Ext.create("Ext.window.Window",{title:I18n.create_permanent_links.text,width:800,height:260,layout:"fit",autoDestroy:!0,closeAction:"destroy",autoScroll:!0,modal:!1,items:[Ext.create("webmapjsext.WMJSExt.PermaLinkPanel",{mappanel:mainWebmapJS})]});e.show()}},
{text:I18n.add_custom_wms_service.text,iconCls:"button_layerlist_layernew",handler:function(){Ext.create("webmapjsext.WMJSExt.DataPanel",{dataPanelClicked:c,webMapJS:mainWebmapJS.webMapJS}).showCustomWMSWindow()}},{text:I18n.undo_zoom_pan_action.text,iconCls:"button_undo",handler:function(){mainWebmapJS.webMapJS.setPreviousExtent()}},{text:I18n.redo_zoom_pan_action.text,iconCls:"button_redo",handler:function(){mainWebmapJS.webMapJS.setNextExtent()}},{text:I18n.abort_loading.text,iconCls:"button_stoploading",
handler:function(){mainWebmapJS.webMapJS.abort()}}];try{isDefined(getFeatureInfoApplications)}catch(g){getFeatureInfoApplications=[]}for(var m={},k=0;k<getFeatureInfoApplications.length;m={$jscomp$loop$prop$location$9$19:m.$jscomp$loop$prop$location$9$19},k++)m.$jscomp$loop$prop$location$9$19=getFeatureInfoApplications[k],p.push({text:getFeatureInfoApplications[k].name,iconCls:getFeatureInfoApplications[k].iconCls,location:m.$jscomp$loop$prop$location$9$19,handler:function(g){return function(){b.setApplication(g.$jscomp$loop$prop$location$9$19);
b.hide();b.show()}}(m)}),getFeatureInfoApplications.open&&m.$jscomp$loop$prop$location$9$19.name===getFeatureInfoApplications.open&&b.setApplication(m.$jscomp$loop$prop$location$9$19);p.push({text:I18n.about_the_adaguc_viewer.text,iconCls:"button_info",tooltip:I18n.about_the_adaguc_viewer.tooltip,handler:function(){Ext.create("Ext.window.Window",{title:I18n.about_adaguc.text,height:200,width:400,modal:!0,layout:"fit",items:{xtype:"panel",html:'<div class="about_adaguc" style="position:absolute;top:0px;left:0px;height:100px;width:520px;"/><div style="position:absolute;top:100px;padding:10px;margin:10px;">'+
versionInfo+I18n.about_adaguc_more_information.text}}).show()}});m=Ext.create("Ext.panel.Panel",{header:!1,title:" ",frame:!1,border:0,split:!1,id:"layerlistpanel",tooltip:I18n.layers.tooltip,overflowY:"auto",bodyCls:"layerlistbg",iconCls:"button_layers32",bbar:[{scale:"small",tooltip:I18n.add_new_layer.tooltip,iconCls:"layer_logos button_layerlist_layernew",handler:function(){createNewLayerPanel(mainWebmapJS.webMapJS,{service:""})}},{iconCls:"button_duplicate",tooltip:I18n.clone_this_layer.tooltip,
handler:function(){var g=getSelectedLayer();isDefined(g)&&g.duplicateLayer()}},{xtype:"button",tooltip:I18n.remove_this_layer.tooltip,iconCls:"button_layerlist_layerdelete",handler:function(g,h){removeLayer()}},{xtype:"button",tooltip:I18n.move_layer_up.tooltip,iconCls:"button_layerlist_layerup",handler:function(g,h){g=getSelectedLayer();isDefined(g)&&g.moveUp()}},{xtype:"button",tooltip:I18n.move_layer_down.tooltip,iconCls:"button_layerlist_layerdown",handler:function(g,h){g=getSelectedLayer();isDefined(g)&&
g.moveDown()}},{xtype:"tbfill"},{iconCls:"button_settings_icon",tooltip:I18n.settings_and_options.tooltip,menu:{xtype:"menu",items:p}}]});k=Ext.create("webmapjsext.WMJSExt.MapTypeSelector",{maptypeclicked:function(g){mainWebmapJS.webMapJS.setProjection({bbox:g.get("bbox"),srs:g.get("srs")});(g=g.get("baselayer"))&&g.service&&g.name&&(g.enabled=!0,mainWebmapJS.baseLayer.setService(g.service),mainWebmapJS.baseLayer.name=g.name,mainWebmapJS.baseLayer.enabled=!0,isDefined(g.transparent)&&(mainWebmapJS.baseLayer.transparent=
g.transparent),mainWebmapJS.baseLayer.parseLayer(function(){mainWebmapJS.webMapJS.draw("maptypeclicked")},void 0,"WMJSExtMain::maptypeclicked"))},webmapjsext:mainWebmapJS});var l=Ext.create("webmapjsext.WMJSExt.BaseMapSelector",{webmapjsext:mainWebmapJS}),t=Ext.create("Ext.Viewport",{layout:"border",items:[{id:"viewportwestpanel",width:400,region:"west",layout:"border",collapsible:!0,animCollapse:!1,border:!0,split:!0,header:!1,autoScroll:!1,frame:!0,items:[{layout:"fit",border:!1,autoScroll:!1,region:"center",
xtype:"tabpanel",scale:"large",cls:"LayersAndMapsTab",items:[m,k,l,timeselectorPanel]}],tbar:[{scale:"large",text:I18n.add_layers.text,tooltip:I18n.add_layers.tooltip,iconCls:"button_adddata32",handler:function(){Ext.create("webmapjsext.WMJSExt.DataPanel",{dataPanelClicked:c,webMapJS:mainWebmapJS.webMapJS}).show()}},{iconCls:"button_settings32",tooltip:I18n.settings_and_options.tooltip,scale:"large",menu:{xtype:"menu",items:p}}]},a],renderTo:Ext.getBody(),listeners:{resize:{fn:function(){try{var g=
viewportwestpanelwindow.y+viewportwestpanelwindow.height;g>t.height&&(g=t.height-70,70>g&&(g=70));viewportwestpanelwindow.setSize(viewportwestpanelwindow.width,g)}catch(h){}}}}}),q=function(g){var h=!1,v=!1;isDefined(g.collapse)&&"1"==g.collapse&&Ext.getCmp("viewportwestpanel").collapse();isDefined(g.zoomtolayer)&&"1"==g.zoomtolayer&&(h=!0);isDefined(g.srs)&&isDefined(g.bbox)&&mainWebmapJS.webMapJS.setProjection({srs:g.srs,bbox:g.bbox});if(isDefined(g.service)){clearLayers(mainWebmapJS.webMapJS);
var r=URLDecode(g.service).split(","),n=[""];isDefined(g.layer)?n=URLDecode(g.layer).split(","):1==h&&(v=!0);isDefined(g.selected);for(var u=n.length,x=0;x<n.length;x++)try{var w=n[n.length-1-x].split("$"),y=w+"",A=!0,z="",C=1,B=r[0]+"";6==w.length&&(y=w[0],A=w[2],z=w[3],C=w[4],isDefined(A)&&("true"===A&&(A=!0),"false"===A&&(A=!1)),B=r[w[5]]);createNewLayerPanel(mainWebmapJS.webMapJS,{service:B,name:y,style:z,enabled:A,opacity:C,ready:function(D,E){u--;if(0==u){if(isDefined(g.dims))for(var H=g.dims.split(","),
F=0;F<H.length;F++){var G=H[F].split("$");2==G.length&&mainWebmapJS.webMapJS.setDimension(G[0],G[1])}1==h&&D.WMJSLayer.zoomToLayer();E.draw("index.html::numlayers=0")}},autoChooseLayer:v})}catch(D){error("Unable to parse layer nr "+x)}if(isDefined(g.baselayers)){r=g.baselayers.split("$");v=[];for(x=n=0;x<r.length;x++){w=!1;for(y=0;y<mapTypeConfiguration.length;y++)if(mapTypeConfiguration[y].baselayer.name==r[x]){mapTypeConfiguration[y].baselayer.enabled=!0;v.push(mapTypeConfiguration[y].baselayer);
w=!0;n++;break}if(!w)for(y=0;y<baseLayerConfiguration.length;y++)if(baseLayerConfiguration[y].name==r[x]){baseLayerConfiguration[y].enabled=!0;v.push(baseLayerConfiguration[y]);w=!0;n++;break}w||error("Warning: unable to find baselayer "+r[x])}for(x=0;x<baseLayerConfiguration.length;x++)0==baseLayerConfiguration[x].enabled?v.push(baseLayerConfiguration[x]):0==n&&v.push(baseLayerConfiguration[x]);baseLayers=[];for(x=0;x<v.length;x++)r=new WMJSLayer(v[x]),0==x&&(mainWebmapJS.baseLayer=r),baseLayers.push(r);
0<baseLayers.length&&mainWebmapJS.webMapJS.setBaseLayers(baseLayers)}}g&&g.autowms&&(autowmsURL=g.autowms+"",-1===autowmsURL.indexOf("?")&&(autowmsURL+="?"),window.setTimeout(function(){b.setApplication(getFeatureInfoApplications.filter(function(D){return"AutoWMS"===D.name})[0]);b.hide();b.show()},100));g&&g.wms&&(console.log("wms found",g.wms),createNewLayerPanel(mainWebmapJS.webMapJS,{service:g.wms}))};0==window.location.hash.length&&q(getUrlVars());checkIfHashTagChanged(function(g,h){if(0<=g.indexOf("addlayer('")){if(h=
g.substring(g.indexOf("addlayer('")+10,g.indexOf("',")),g=g.substring(g.indexOf(",'")+2,g.indexOf("')")),h&&g){for(var v=!1,r=mainWebmapJS.webMapJS.getLayers(),n=0;n<r.length;n++)if(r[n].service==h&&r[n].name==g){v=!0;break}0==v&&(isDefined(hashLocationNotfiyAddLayer),firstTimeOpening=!0,createNewLayerPanel(mainWebmapJS.webMapJS,{service:h,name:g,zoomtolayer:!1,notifyadded:!0}))}}else 0<=g.indexOf("positionmappinbylatlon(")?(debug(g),h=g.substring(23,g.indexOf(")")),debug(h),h=h.split(","),debug(h[0]+
" "+h[1]),mainWebmapJS.webMapJS.positionMapPinByLatLon({x:parseFloat(h[0]),y:parseFloat(h[1])})):0<=g.indexOf("refreshlayers")?updateLayers():q(h)});getFeatureInfoApplications.open&&b.show()});var gfiapp_d3c3=function(a,b){var c=function(q,g){$("#"+g).empty();$("#"+g).append("<div style='height=240px;border=2px solid blue;' class='chart'>a</div>");$("#"+g).append("<div style='height=40px;border=2px solid red;' class='controls gfiapp_d3c3_export_to_csv_button'>b</div>");var h=$("#"+g).find(".chart");g=$("#"+g).find(".controls");h.html("graph");g.button({label:"Export to CSV"}).click(function(){console.log("Export to CSV");for(var v="",r=q.datatoplot,n=0;n<r[0].length;n++){for(var u=0;u<
r.length;u++)0<u&&(v+=";"),v+=JSON.stringify(r[u][n]);v+="\n\r"}r=document.createElement("a");r.setAttribute("download","export.csv");r.setAttribute("href",encodeURI("data:text/csv;charset=utf-8,"+v));console.log("Clicking link");document.body.appendChild(r);r.click();r.remove()});c3.generate({bindto:h.get(0),data:{x:"x",x_format:"%Y%m%d",columns:q.datatoplot,types:{x:"area"}},axis:{x:{type:"timeseries",tick:{format:q.timeFormat}},y:{label:q.ylabel}},zoom:{enabled:!0},subchart:{show:!1}})},e=function(q,
g){return q>g?1:q<g?-1:0},f=function(q,g){var h;for(h=0;h<g.length;h++)try{if(g[h].getTime()===q.getTime())return h}catch(v){}return-1},p=function(q,g){var h=1;"string"!=typeof q[0].dims&&(h=q[0].dims.length);for(var v=[],r=function(w,y,A){var z=["x"];w=[y.name+" "+w];for(var C in A){y=d3.time.format("%Y-%m-%dT%H:%M:%SZ").parse(C);var B=parseFloat(A[C]);z.push(y);w.push(B)}v.push({date:z,value:w})},n=function(w,y,A,z){if(1==h)r("",y,A);else if(w+2<h)for(d in A)n(w+1,y,A[d],z+"["+d+"]");else for(d in A)r("["+
d+"]",y,A[d])},u=0;u<q.length;u++)n(0,q[u],q[u].data,"");u=function(w){for(var y=[],A=w.length,z=0;z<A;z++)for(var C=w[z].date,B=1;B<C.length;B++){var D=C[B],E=f(D,y);-1==E&&y.push(D)}y.sort(e);y.unshift("x");C=[];for(B=0;B<A;B++)C.push([]);for(z=0;z<A;z++)for(C[z].push(w[z].value[0]),B=1;B<y.length;B++)E=f(y[B],w[z].date),E==B?(D=w[z].value[E],"nodata"==D&&(D=NaN),C[z].push(parseFloat(D))):C[z].push(NaN);w=[];w.push(y);for(z=0;z<A;z++)w.push(C[z]);return w}(v);var x=q[0].name;q[0].units&&(x+=" in "+
q[0].units);c({datatoplot:u,ylabel:x,timeFormat:"%Y-%m-%d %H:%M"},g)},m=function(q,g){$.ajax({type:"GET",url:q+"&JSONP=?",dataType:"jsonp",cache:!1,success:function(h){try{p(h,g)}catch(v){$("#"+g).html("Sorry! An error occurred while parsing JSON data: ["+v+"]")}},error:function(h,v,r){$("#"+g).html("Sorry! An error occurred while receiving JSON data from the server: ["+r+"]");console.log("Error "+r)}})},k=!0,l=[];l.set=!1;var t=function(q){if(0!=k){l.x=q.x;l.y=q.y;l.set=!0;var g=b.getLatLongFromPixelCoord({x:q.x,
y:q.y});$("#chart").html('<img src="./img/ajax-loader.gif" alt="Loading..."/>');var h=b.getLayers();if(isDefined(h)){g="timeseries graph for location ["+Math.round(100*g.x)/100+","+Math.round(100*g.y)/100+"]<br/>";$("#chart").empty();for(var v=0;v<h.length;v++){var r=b.getWMSGetFeatureInfoRequestURL(h[v],q.x,q.y);r=composeUrlObjectFromURL(r);var n=r.location+"?";for(key in r.kvp){var u=r.kvp[key];"info_format"==key&&(u="application/json");"time"==key&&(u="1000-01-01T00:00:00Z/3000-01-01T00:00:00Z");
"dim_member"==key&&(u="*");"dim_ensemble_member"==key&&(u="*");"dim_percentile"==key&&(u="*");n+=key+"="+URLEncode(u)+"&"}$("#chart").append("<div class='chartstyle' id='chart"+v+"'></div>");$("#chart"+v).html('<img src="./img/ajax-loader.gif" alt="Loading..."/>');m(n,"chart"+v)}$("#info").html(g)}else $("#info").html("No valid data received:<br/>"+data)}};b.addListener("mouseclicked",t,!0);this.enable=function(){a.html('<div id="info"></div><div id="chart" class="gfiapp_d3c3"></div>');$("#info").html("Click on the map to create a timeseries graph.");
console.log("init");b.enableInlineGetFeatureInfo(!1);k=!0};this.disable=function(){k=!1;b.enableInlineGetFeatureInfo(!0);l.set=!1};this.resize=function(q,g){console.log("w="+q);$("#chart").width(q);l.set&&t(l)};this.enable()};try{WMJSExtApplications["Time series mode"]=gfiapp_d3c3}catch(a){};var gfiapp_point_interest=function(a,b){var c=this,e=[],f=!0,p=function(m,k){var l=null,t=null,q=null;setflags=function(){l&&t&&q?(lon=l,lat=t,name=q,fullUrl=knmiFlagURL+"file="+pointInterestFileName+"&location="+lon+","+lat+"&name="+name,$.ajax({type:"GET",url:fullUrl,success:function(h){"OK"===h.status?(h=Ext.getCmp("webmapjs_add_point_interest"),h.getEl().dom.style.background="#BCED91",b.getImageStore().clear(),b.draw("draw")):(h=Ext.getCmp("webmapjs_add_point_interest"),h.getEl().dom.style.background=
"#FF4040")},dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultSetFlag",crossDomain:!0})):(q||$("#webmapjs_point_interest_name").css("border","2px solid red"),l||$("#webmapjs_point_interest_lon").css("border","2px solid red"),t||$("#webmapjs_point_interest_lat").css("border","2px solid red"))};delete_flag=function(){Ext.MessageBox.show({title:I18n.delete_title_confirm.text,msg:I18n.are_you_sure.text,buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.WARNING,fn:function(h){"yes"==
h&&(name=$(".webmapjs_label_selected_point_interest").text(),fullUrl=knmiFlagURL+"file="+pointInterestFileName+"&name="+name,$.ajax({type:"GET",url:fullUrl,success:function(v){Ext.getCmp("webmapjs_delete_point_interest").getEl().dom.style.background="#BCED91";b.getImageStore().clear();b.draw()},dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultSetFlag",crossDomain:!0}))}})};a.html("<label class='webmapjs_label_point_interest' for='webmapjs_div_point_interest'>"+I18n.add_point_interest_abstract.text+
"</label><div id='webmapjs_div_point_interest' class='webmapjs_div_point_interest'><input type='number' step='0.01' id='webmapjs_point_interest_lat' class='webmapjs_input_point_interest' placeholder='Lat:'/><input type='number' step='0.01' id='webmapjs_point_interest_lon' class='webmapjs_input_point_interest' placeholder='Lon:'/><input type='text' id='webmapjs_point_interest_name' class='webmapjs_input_point_interest' placeholder='"+I18n.insert_name.text+"' /></div><div class='webmapjs_point_added'></div><div class='webmapjs_point_not_added'></div><label class='webmapjs_label_selected_point_interest_abstract' for='webmapjs_div_selected_point_interest'>"+
I18n.selected_flag.text+"</label><div id='webmapjs_div_selected_point_interest' class='webmapjs_div_selected_point_interest'><label class='webmapjs_label_selected_point_interest'>"+I18n.default_selected_flag.text+"</label></div>");Ext.create("Ext.Button",{text:I18n.add_point_interest.text,id:"webmapjs_add_point_interest",tooltip:I18n.add_flag_tooltip.tooltip,renderTo:"webmapjs_div_point_interest",handler:function(){setflags()}});Ext.create("Ext.Button",{text:I18n.delete.text,id:"webmapjs_delete_point_interest",
tooltip:I18n.delete_selected_flag_tooltip.tooltip,renderTo:"webmapjs_div_selected_point_interest",cls:"webmapjs_button_delete_point_interest",handler:function(){delete_flag()}});$("#webmapjs_point_interest_name, #webmapjs_point_interest_lon, #webmapjs_point_interest_lat").keypress(function(h){if(13==h.which)return setflags(),!1});var g=function(){var h=a.find(".gfiapp_point_interest");h.empty();for(var v=b.getLayers(),r=0;r<v.length;r++){var n=v[r],u=jQuery("<div />",{css:{margin:8}});h.append(u);
u.html("LAYER "+n.service)}c.resize(m,k)};g();b.addListener("onlayeradd",g,!0);b.addListener("mouseclicked",function(h){if(0!=f){var v=b.getLatLongFromPixelCoord({x:h.x,y:h.y});l=v.x;t=v.y;$("#webmapjs_point_interest_lon").val(v.x.toFixed(5));$("#webmapjs_point_interest_lat").val(v.y.toFixed(5));$("#webmapjs_point_interest_lon, #webmapjs_point_interest_lat").css("border","1px solid grey");v=b.getLayers();h=b.getWMSGetFeatureInfoRequestURL(v[0],h.x,h.y).replace("&INFO_FORMAT=text/html","&INFO_FORMAT=application/json")+
"&JSONP=featureInfoCallback";$.ajax({dataType:"jsonp",jsonpCallback:"featureInfoCallback",type:"GET",cache:!1,url:h,success:function(r){r[1]&&"nodata"!==r[1].data?($(".webmapjs_label_selected_point_interest").text(r[1].data),$(".webmapjs_button_delete_point_interest").css("display","inline")):($(".webmapjs_label_selected_point_interest").text(I18n.default_selected_flag.text),$(".webmapjs_button_delete_point_interest").css("display","none"))},error:function(r,n,u){debug(n+", "+u)}})}},!0);$("#webmapjs_point_interest_name").on("input",
function(h){onChangeEvents("name",h)});$("#webmapjs_point_interest_lon").on("input",function(h){onChangeEvents("lon",h);changeMapPin()});$("#webmapjs_point_interest_lat").on("input",function(h){onChangeEvents("lat",h);changeMapPin()});this.onChangeEvents=function(h,v){var r=Ext.getCmp("webmapjs_add_point_interest");r.getEl().dom.style.background="";r=Ext.getCmp("webmapjs_delete_point_interest");r.getEl().dom.style.background="";switch(h){case "name":q=v.target.value;break;case "lon":l=v.target.value;
break;case "lat":t=v.target.value}$("#webmapjs_point_interest_"+h).css("border","1px solid grey")};this.changeMapPin=function(){b.positionMapPinByLatLon({x:l,y:t})};b.enableInlineGetFeatureInfo(!1)};this.enable=function(m,k){p(m,k);f=!0};this.disable=function(){f=!1;b.enableInlineGetFeatureInfo(!0)};this.resize=function(m,k){for(var l=0;l<e.length;l++)e[l].setSize(m,k/e.length);for(l=0;l<e.length;l++);};c.enable()};WMJSExtApplications["Points of interest"]=gfiapp_point_interest;var gfiapp_eprofile=function(a,b){var c=this,e=[],f=function(p,m){a.html('<div id="info"></div><div class="gfiapp_eprofile">bla</div>');var k=function(q,g){g=g.id;for(var h=0;h<e.length;h++){var v=e[h].getWebMapJS();v.suspendEvent("onupdatebbox");h!=g&&0==q.equals(e[h].getWebMapJS().getProjection().bbox)&&(v.zoomTo(q),e[h].updateBBOX(q));v.resumeEvent("onupdatebbox")}},l=function(q,g){q=g.id;for(g=0;g<e.length;g++){var h=e[g].getWebMapJS();h.suspendEvent("onupdatebbox");h.suspendEvent("onloadingcomplete");
g!=q&&h.draw();h.resumeEvent("onloadingcomplete");h.resumeEvent("onupdatebbox")}},t=function(){var q=a.find(".gfiapp_eprofile");q.empty();for(var g=b.getLayers(),h=0;h<g.length;h++){var v=g[h],r=jQuery("<div />",{css:{margin:8}});q.append(r);e[h]=new GFITimeElevationWindow(r);e[h].getWebMapJS().addLayer(v);e[h].getWebMapJS().getListener().id=h;e[h].getWebMapJS().addListener("onupdatebbox",k,!0);e[h].getWebMapJS().addListener("onloadingcomplete",l,!0)}c.resize(p,m)};t();b.addListener("ondimchange",
function(){var q=e[0].getWebMapJS(),g=q.getProjection().bbox.clone();q=q.getProjection().bbox.right-q.getProjection().bbox.left;var h=(new Date(b.getDimension("time").currentValue)).getTime();g.left=h;g.right=h+q;for(q=0;q<e.length;q++)e[q].getWebMapJS().zoomTo(g)},!0);b.addListener("onlayeradd",t,!0);e[0].getWebMapJS().addListener("onloadingcomplete",function(){var q=e[0].getWebMapJS().getProjection().bbox.clone();$("#info").html("Displaying dates "+b.dateToISO8601(new Date(q.left))+" till "+b.dateToISO8601(new Date(q.right)))},
!0);b.enableInlineGetFeatureInfo(!1)};this.enable=function(p,m){f(p,m)};this.disable=function(){b.enableInlineGetFeatureInfo(!0)};this.resize=function(p,m){for(var k=0;k<e.length;k++)e[k].setSize(p,m/e.length);for(k=0;k<e.length;k++);};c.enable()};try{WMJSExtApplications.EProfile=gfiapp_eprofile}catch(a){};var histograms=[],gfiapp_histogram=function(a,b){var c=function(l,t){$.ajax({type:"GET",url:l+"&JSONP=?",dataType:"jsonp",cache:!1,success:function(q){try{var g=Object.keys(q)[0],h=q[g],v="layer_"+histograms.length+"_"+g;$("#"+t).empty();$("#"+t).append("<div style='height=240px;border=2px solid blue;' class='chart'>a</div>");var r=$("#"+t).find(".chart");r.html("graph");histograms.push([v].concat($jscomp.arrayFromIterable(h.quantity)));var n=[["x"].concat($jscomp.arrayFromIterable(h.interval))];
for(q=0;q<histograms.length;q++)n.push(histograms[q]);c3.generate({bindto:r.get(0),data:{x:"x",columns:n}})}catch(u){console.error(u),0===histograms.length&&$("#"+t).html("Error occured....")}},error:function(q,g,h){console.log("Error "+h);0===histograms.length&&$("#"+t).html("Error occured....")}})},e=this,f=!0,p=[];p.set=!1;var m=function(l){histograms=[];if(0!=f){p.set=!0;$("#chart").html('<img src="./img/ajax-loader.gif" alt="Loading..."/>');histograms=[];var t=b.getLayers();if(isDefined(t)){var q=
"Histogram graph for area ["+Math.round(100*l.left)/100+","+Math.round(100*l.bottom)/100+","+Math.round(100*l.right)/100+","+Math.round(100*l.top)/100+"]<br/>";$("#chart").empty();for(var g=0;g<t.length;g++)if(t[g].enabled){var h=b.buildWMSGetMapRequest(t[g]);h=composeUrlObjectFromURL(h);var v=h.location+"?";for(key in h.kvp){var r=h.kvp[key];"request"==key&&(r="GetHistoGram");if("bbox"==key){r=h.kvp.crs;var n=!1;"1.3.0"===h.kvp.version&&"EPSG:4326"===r&&(n=!0);r=n?l.bottom+","+l.left+","+l.top+","+
l.right:l.left+","+l.bottom+","+l.right+","+l.top}v+=key+"="+URLEncode(r)+"&"}$("#chart").append("<div class='chartstyle' id='chart0'></div>");$("#chart"+g).html('<img src="./img/ajax-loader.gif" alt="Loading..."/>');c(v,"chart0")}$("#info").html(q)}else $("#info").html("No valid data received:<br/>"+data)}},k=function(){a.html('<div id="info"></div><div id="chart" class="gfiapp_histogram"></div>');$("#info").html("Click on the map to create a histogram graph.");b.enableInlineGetFeatureInfo(!1);b.setMapModeZoomBoxIn();
!0!==e.initialized&&b.addListener("beforezoomend",function(l){m(l);return!1},!0);e.initialized=!0};this.enable=function(){k();f=!0};this.disable=function(){f=!1;b.enableInlineGetFeatureInfo(!0);b.setMapModePan();b.removeListener("beforezoomend");b.divZoomBox.style.display="none";p.set=!1};this.resize=function(l,t){$("#chart").width(l);p.set&&m(p)};e.enable()};try{WMJSExtApplications["Histogram mode"]=gfiapp_histogram}catch(a){};var autowms_app=function(a,b){initWMJS();a.addClass("autowms_app_container");var c="https://geoservices.knmi.nl/autowms?";try{c=autowmsURL}catch(g){}var e={},f=[],p=function(g){var h=l();a.html(h+JSON.stringify(g));$(".autowms_app_fileitem_return").attr("onclick","").click(function(v){f=[];q("")});$(".autowms_app_fileitem_refresh").attr("onclick","").click(function(v){var r=$(this).attr("name");$(".autowms_app_fileitem").remove();$(".autowms_app_layeritem").remove();setTimeout(function(){q(r)},100)})},
m=function(g){var h=g.name;return g.leaf?"<span class='autowms_app_fileitem' name='"+g.name+"'>&#128451;&nbsp;"+h+"</span>":"<span class='autowms_app_fileitem autowms_app_diritem' name='"+g.name+"'>&#128448;&nbsp;"+h+"</span>"},k=function(g,h){var v="<span class='autowms_app_layeritem' title='Click to add to viewer' name='"+g.name+"'><span class='autowms_app_layeritem_text'>Layer "+g.text+" - ("+g.name+")</span>";return v+="<span class='autowms_app_layeritem_image'><img src=\""+(h+"&service=WMS&request=getmap&format=image/png&layers="+
g.name+"&width=400&CRS=EPSG:4326&STYLES=&EXCEPTIONS=INIMAGE&showlegend=true&"+Math.random())+'" /></span></span>'},l=function(g,h){return"<span class='autowms_app_currentpath'>AutoWMS link: <span class='autowms_app_request_container'><input class='autowms_app_request_input' type=\"text\" value=\""+c+"\"></input>  <span class='autowms_app_request_button'>-></span></span><hr/><span class='autowms_app_currentpath'>Current folder: ./"+(h+'</span><span class="autowms_app_fileitem_header"><span class="autowms_app_fileitem_return">&#128193;&nbsp;<b>../ (&#8679;)</b></span><span class="autowms_app_fileitem_refresh" name="')+
(h+'">&#8635;&nbsp;<b>Refresh</b></span></span>')},t=function(g,h){a.html("... working ... ");var v=WMJSGetServiceFromStore(h,xml2jsonrequestURL);v.getLayerObjectsFlat(function(r){var n=""+l(g,h);n+="<span class='autowms_app_serviceabstract'><b>"+v.title.replace(/!/g,"<br/>")+"</b><hr/>"+v.abstract.replace(/!/g,"<br/>");if(h&&(n+='<hr/>WMS: <a target="_blank" href="'+h+'&service=WMS&request=GetCapabilities">'+h+"</a>",1<h.split("?").length)){var u=new WMJSKVP(h.split("?")[1]),x=h.split("?")[0].replace("adagucserver",
"adagucopendap/");x=x.replace(/([^:]\/)\/+/g,"$1");u.source&&(x+=u.source);u.dataset&&(x+=u.dataset+"/");n=n+('<hr/>OpenDAP: <span class=\'autowms_app_opendaplinks\'><a target="_blank" href="'+x+'">'+x+'</a><a target="_blank" href="')+(x+'.das">DAS</a><a target="_blank" href="')+(x+'.dds">DDS</a></span>')}n+="</span>";a.html("... working ... ");e={};for(u=0;u<r.length;u++)n+=k(r[u],h),e[r[u].name]=r[u];a.html(n);$(".autowms_app_layeritem").attr("onclick","").click(function(w){w=e[$(this).attr("name")];
window.location.hash="addlayer('"+h+"','"+w.name+"')"});$(".autowms_app_fileitem_return").attr("onclick","").click(function(w){q(f.pop())});$(".autowms_app_fileitem_refresh").attr("onclick","").click(function(w){var y=$(this).attr("name");$(".autowms_app_fileitem").remove();$(".autowms_app_layeritem").remove();setTimeout(function(){t(g,y)},100)});$(".autowms_app_request_button").attr("onclick","").click(function(w){q("")});$(".autowms_app_request_input").keyup(function(w){13==w.keyCode&&q("")})},
function(r){r=l();r=r+"<span class='autowms_app_error_container'><span class='autowms_app_error_container_header'>Unable to get WMS GetCapabilities</span><a target='_blank' href=\""+(h+'service=WMS&request=GetCapabilities">'+h+"</a>");a.html(r+"</span>");$(".autowms_app_fileitem_return").attr("onclick","").click(function(n){f=[];q("")})},!0)},q=function(g){g&&"undefined"!==g||(g="");var h=$(".autowms_app_request_input").first().val();h&&0<h.length&&(c=h.trim().split("?")[0],c.endsWith("?")||(c+="?"));
var v=function(n){if(n.error)a.html("Error from server: "+n.error);else{e={};f[f.length-1]!==g&&f.push(g);var u=l(n,g);a.html("... working ... ");n.result.sort(function(w,y){return w.name.localeCompare(y.name)});n.result.sort(function(w,y){if(w.leaf===y.leaf)return 0;if(!0===w.leaf)return 1;if(!0===y.leaf)return-1});for(var x=0;x<n.result.length;x++)u+=m(n.result[x]),e[n.result[x].name]=n.result[x];a.html(u);$(".autowms_app_fileitem_return").attr("onclick","").click(function(w){f.pop();q(f[f.length-
1])});$(".autowms_app_fileitem_refresh").attr("onclick","").click(function(w){var y=$(this).attr("name");$(".autowms_app_fileitem").remove();$(".autowms_app_layeritem").remove();setTimeout(function(){q(y)},100)});$(".autowms_app_fileitem").attr("onclick","").click(function(w){w=e[$(this).attr("name")];!1===w.leaf?q(w.path):t(n,w.adaguc)});$(".autowms_app_request_button").attr("onclick","").click(function(w){q("")});$(".autowms_app_request_input").keyup(function(w){13==w.keyCode&&q("")})}},r=c+"request=getfiles&path="+
g;a.html('... Reading <a href="'+r+'">'+r+"</a> ... ");try{$.ajax({contentType:"application/json",crossDomain:!0,type:"GET",url:r,success:v,error:function(n){console.error("Request failed without jsonp, trying jsonp");v({result:[]});$.ajax({dataType:"jsonp",contentType:"application/jsonp",crossDomain:!0,type:"GET",url:r,success:v,error:function(u){p("Unable to do ajax call")}})}})}catch(n){console.error(n),p(n)}};this.enable=function(){a.html("<div>Initializing...</div>");q("")};this.disable=function(){};
this.resize=function(g,h){}};try{WMJSExtApplications.AutoWMS=autowms_app}catch(a){};
//# sourceMappingURL=WMJSExt.min.js.map
